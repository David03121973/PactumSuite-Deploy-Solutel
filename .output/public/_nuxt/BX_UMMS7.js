import{P as te,r,L as K,o as J,T as ae,z as f,D as O,A as e,y as x,F as T,B as p,C as $,I as v,J as b,M as oe,N as ie,q as j,S as C,E as se,n as le,h as I}from"#entry";import{_ as re,N as ne}from"./B2AczXHm.js";import{S as de}from"./CC2Sf2Ne.js";import{D as ue}from"./Dx2RwFw2.js";import{_ as ce}from"./0uQ-aPjh.js";import{_ as me}from"./BJDyHLIH.js";import{_ as pe}from"./rxRbyMz-.js";const ge={class:"text-lg font-semibold text-gray-900"},fe={key:0,class:"space-y-6"},ve={class:"bg-gray-50 rounded-lg p-4"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ye={class:"mt-1 text-sm text-gray-900"},xe={class:"mt-1 text-sm text-gray-900"},we={class:"bg-blue-50 rounded-lg p-4"},ke={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},he={class:"mt-1 text-sm text-gray-900"},Se={class:"mt-1 text-sm text-gray-900"},Ce={class:"md:col-span-2"},$e={class:"mt-1 text-sm text-gray-900"},Ve={class:"bg-gray-50 rounded-lg p-4"},Ne={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ee={class:"mt-1 text-sm text-gray-900"},Ae={class:"mt-1 text-sm text-gray-900"},_e={class:"mt-1 text-sm text-gray-900"},De={key:1,class:"space-y-6"},Pe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ue=["value"],je={class:"md:col-span-2"},Ie={key:0,class:"bg-red-50 border border-red-200 text-red-700 p-3 rounded"},Te={class:"flex justify-end gap-2"},Be={__name:"SalidaModal",props:{modelValue:{type:Boolean,default:!1},salida:{type:Object,default:()=>({})},isViewing:{type:Boolean,default:!0},isEditing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(n,{emit:E}){const g=n,A=E,o=te({id_producto:null,id_usuario:null,cantidad:null,descripcion:"",fecha:""}),y=r(""),m=r(""),c=r([]);K(()=>g.salida,i=>{if(i&&Object.keys(i).length)o.id_producto=i.id_producto||i.producto?.id_producto||null,m.value=i.producto?.nombre||"",o.cantidad=i.cantidad||null,o.descripcion=i.descripcion||"",o.fecha=i.fecha?i.fecha.substring(0,10):"",o.id_usuario=i.id_usuario||null,y.value=i.usuario?.nombre||"";else{o.id_producto=null,m.value="",o.cantidad=null,o.descripcion="",o.fecha="";{const t=JSON.parse(localStorage.getItem("usuario"));t&&(o.id_usuario=t.id_usuario,y.value=t.nombre)}}},{immediate:!0,deep:!0});function h(i){i?(o.id_producto=i.id_producto,m.value=i.nombre):(o.id_producto=null,m.value="")}function w(){if(c.value=[],o.id_producto||c.value.push("Debe seleccionar un producto"),(o.cantidad==null||Number(o.cantidad)<=0)&&c.value.push("La cantidad debe ser mayor que 0"),o.fecha||c.value.push("Debe seleccionar una fecha"),o.descripcion||c.value.push("Debe añadir una descripción"),c.value.length)return;const i={id_producto:o.id_producto,id_usuario:o.id_usuario,fecha:o.fecha,descripcion:o.descripcion,cantidad:Number(o.cantidad)};A("submit",i)}return K(()=>g.modelValue,i=>{if(i){if(!g.isEditing&&!g.isViewing){const t=JSON.parse(localStorage.getItem("usuario"));t&&(o.id_usuario=t.id_usuario,y.value=t.nombre)}}else c.value=[]}),J(()=>{{const i=JSON.parse(localStorage.getItem("usuario"));i&&(!g.isEditing&&!g.isViewing&&(o.id_usuario=i.id_usuario),y.value=i.nombre)}}),(i,t)=>(f(),ae(me,{show:n.modelValue,onClose:t[5]||(t[5]=d=>i.$emit("update:modelValue",!1)),size:"2xl"},{title:O(()=>[e("h3",ge,p(n.isViewing?"Detalles de la Salida":n.isEditing?"Editar Salida":"Nueva Salida"),1)]),content:O(()=>[n.isViewing?(f(),x("div",fe,[e("div",ve,[t[8]||(t[8]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Producto",-1)),e("div",be,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1)),e("p",ye,p(n.salida.producto?.nombre||"N/A"),1)]),e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm font-medium text-gray-700"},"Código",-1)),e("p",xe,p(n.salida.producto?.codigo||"N/A"),1)])])]),e("div",we,[t[12]||(t[12]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información de la Salida",-1)),e("div",ke,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700"},"Cantidad",-1)),e("p",he,p(n.salida.cantidad),1)]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),e("p",Se,p(n.salida.fecha?new Date(n.salida.fecha).toLocaleDateString("es-ES"):"N/A"),1)]),e("div",Ce,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700"},"Descripción",-1)),e("p",$e,p(n.salida.descripcion||"Sin descripción"),1)])])]),e("div",Ve,[t[16]||(t[16]=e("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Sistema",-1)),e("div",Ne,[e("div",null,[t[13]||(t[13]=e("label",{class:"block text-sm font-medium text-gray-700"},"Creado por",-1)),e("p",Ee,p(n.salida.usuario?.nombre||"N/A"),1)]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700"},"Creado",-1)),e("p",Ae,p(n.salida.createdAt?new Date(n.salida.createdAt).toLocaleString("es-ES"):"N/A"),1)]),e("div",null,[t[15]||(t[15]=e("label",{class:"block text-sm font-medium text-gray-700"},"Última Actualización",-1)),e("p",_e,p(n.salida.updatedAt?new Date(n.salida.updatedAt).toLocaleString("es-ES"):"N/A"),1)])])])])):(f(),x("div",De,[e("div",Pe,[e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),$(pe,{modelValue:o.id_producto,"onUpdate:modelValue":t[0]||(t[0]=d=>o.id_producto=d),endpoint:"/Producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto",placeholder:"Buscar producto...","initial-label":m.value,onProductoSeleccionado:h},null,8,["modelValue","initial-label"])]),e("div",null,[t[18]||(t[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[1]||(t[1]=d=>o.fecha=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,o.fecha]])]),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[2]||(t[2]=d=>o.cantidad=d),min:"0",step:"0.01",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,o.cantidad,void 0,{number:!0}]])]),e("div",null,[t[20]||(t[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),e("input",{type:"text",value:y.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 bg-gray-100",disabled:""},null,8,Ue)]),e("div",je,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=d=>o.descripcion=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Descripción..."},null,512),[[b,o.descripcion]])])]),c.value.length?(f(),x("div",Ie,[(f(!0),x(oe,null,ie(c.value,(d,V)=>(f(),x("div",{key:V},p(d),1))),128))])):T("",!0)]))]),footer:O(()=>[e("div",Te,[n.isViewing?T("",!0):(f(),x("button",{key:0,onClick:w,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90"},p(n.isEditing?"Guardar":"Crear"),1)),e("button",{onClick:t[4]||(t[4]=d=>i.$emit("update:modelValue",!1)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"},"Cerrar")])]),_:1},8,["show"]))}},Oe={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},ze={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Le={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Me={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Fe={class:"bg-white rounded-lg shadow-md p-4"},He={class:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4"},Ke={class:"w-full"},Je={class:"w-full"},Re={class:"w-full"},qe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Ge={class:"w-full"},Qe={class:"w-full"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Xe={class:"w-full"},Ye={class:"w-full"},Ze={class:"w-[95%] mx-auto px-4 py-4"},rt={__name:"salidas",setup(n){const E=r(""),g=r(""),A=r(""),o=r(""),y=r(""),m=r(""),c=r(""),h=r(!1),w=r({}),i=r(!1),t=r(!1),d=r(!1),V=r(null),R=[{key:"fecha",label:"Fecha",cellRenderer:l=>l?`<span class="px-2 py-1 rounded text-sm">${l.substring(0,10)}</span>`:""},{key:"producto.nombre",label:"Producto"},{key:"cantidad",label:"Cantidad"},{key:"descripcion",label:"Descripción"},{key:"usuario.nombre",label:"Usuario"}],P=r(1),z=r(0),_=r(!1),L=r(20),M=r([]),u=r(null),U=le(),F={render(){return I("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[I("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},q=[{name:"Editar",icon:{render(){return I("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[I("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:l=>H(l,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Eliminar",icon:F,handler:l=>W(l),iconOnly:!1,buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}];async function D(l=1){const a=localStorage.getItem("token");if(!a){j("/");return}try{_.value=!0;const s={descripcion:E.value||void 0,fecha_desde:g.value||void 0,fecha_hasta:A.value||void 0,producto_nombre:o.value||void 0,usuario_nombre:y.value||void 0};(m.value!==""||c.value!=="")&&(s.cantidad={},m.value!==""&&(s.cantidad.min=m.value),c.value!==""&&(s.cantidad.max=c.value));const S=await fetch(`${U.public.backendHost}/salida/filterSalidas/${l}/${L.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify(s)});if(S.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{j("/")},3e3);return}if(S.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const N=await S.json();M.value=N.data||[],z.value=N.pagination?.total||0,P.value=N.pagination?.currentPage||1}catch{u.value={title:"Error",description:"No se pudieron cargar las salidas",type:"error"}}finally{_.value=!1}}function H(l,a){w.value={...l},i.value=a==="ver",t.value=a==="editar",h.value=!0}function G(l){H(l,"ver")}function Q(){w.value=null,i.value=!1,t.value=!1,h.value=!0}function W(l){V.value=l,d.value=!0}async function X(){if(V.value)try{const l=localStorage.getItem("token"),a=await fetch(`${U.public.backendHost}/salida/deleteSalida/${V.value.id_salida}`,{method:"DELETE",headers:{Authorization:l,Accept:"application/json"}});if(a.status===401){u.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{j("/")},3e3);return}if(a.status===403){u.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!a.ok){const s=await a.json().catch(()=>({})),S=Array.isArray(s.errors)?s.errors.join(`
`):s.error||"No se pudo eliminar la salida";u.value={title:"Error",description:S,type:"error"};return}u.value={title:"Salida eliminada",description:"Se eliminó correctamente",type:"success"},await D(P.value)}catch{u.value={title:"Error",description:"Ocurrió un error al eliminar",type:"error"}}finally{d.value=!1,V.value=null}}async function Y(l){try{const a=localStorage.getItem("token"),s=t.value&&w.value?.id_salida?`${U.public.backendHost}/salida/updateSalida/${w.value.id_salida}`:`${U.public.backendHost}/salida/createSalida`,S=t.value?"PUT":"POST",N=await fetch(s,{method:S,headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(l)});if(!N.ok){const B=await N.json().catch(()=>({})),ee=Array.isArray(B.errors)?B.errors.join(`
`):B.error||"Error en la operación";u.value={title:"Error",description:ee,type:"error"};return}u.value={title:t.value?"Salida actualizada":"Salida creada",description:"Operación exitosa",type:"success"},h.value=!1,w.value={},t.value=!1,i.value=!1,await D(P.value)}catch{u.value={title:"Error",description:"Ocurrió un error al guardar",type:"error"}}}const k=async()=>{try{_.value=!0,await D(1)}catch(l){console.error("Error al buscar salidas:",l)}finally{_.value=!1}};function Z(l){D(l)}return J(async()=>{if(!localStorage.getItem("token")){j("/");return}await D()}),(l,a)=>(f(),x("div",Oe,[$(de,{title:"Salidas - Pactum",description:"Lista y gestión de salidas de productos.",canonical:"/salidas"}),$(ne),u.value?(f(),x("div",ze,[$(re,{title:u.value.title,description:u.value.description,type:u.value.type,onClose:a[0]||(a[0]=s=>u.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):T("",!0),d.value?(f(),x("div",Le,[$(ce,{title:"¿Estás seguro que deseas eliminar esta salida?",description:"Esta acción no se puede deshacer.",icon:F,type:"warning",onConfirm:X,onClose:a[1]||(a[1]=s=>d.value=!1)})])):T("",!0),e("div",Me,[e("div",Fe,[e("div",He,[e("div",Ke,[a[10]||(a[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Descripción",-1)),v(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=s=>E.value=s),placeholder:"Descripción...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,E.value]])]),e("div",Je,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre del Producto",-1)),v(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=s=>o.value=s),placeholder:"Nombre del producto...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,o.value]])]),e("div",Re,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de Usuario",-1)),v(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=s=>y.value=s),placeholder:"Nombre de usuario...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,y.value]])])]),e("div",qe,[e("div",Ge,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad mínima",-1)),v(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=s=>m.value=s),placeholder:"Cantidad min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,m.value,void 0,{number:!0}]])]),e("div",Qe,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad máxima",-1)),v(e("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=s=>c.value=s),placeholder:"Cantidad max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,c.value,void 0,{number:!0}]])])]),e("div",We,[e("div",Xe,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha desde",-1)),v(e("input",{type:"date","onUpdate:modelValue":a[7]||(a[7]=s=>g.value=s),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,g.value]])]),e("div",Ye,[a[16]||(a[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha hasta",-1)),v(e("input",{type:"date","onUpdate:modelValue":a[8]||(a[8]=s=>A.value=s),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:C(k,["enter"])},null,544),[[b,A.value]])])]),e("div",{class:"flex justify-end mt-4"},[e("button",{onClick:k,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar ")])])]),e("div",Ze,[e("div",{class:"flex justify-between items-center mb-4"},[a[18]||(a[18]=e("h2",{class:"text-2xl font-bold"},"Salidas",-1)),e("button",{onClick:Q,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...a[17]||(a[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),se(" Nueva Salida ",-1)])])]),$(ue,{columns:R,items:M.value,actions:q,"total-items":z.value,"items-per-page":L.value,"current-page":P.value,"is-loading":_.value,onPageChange:Z,onRowClick:G},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),$(Be,{modelValue:h.value,"onUpdate:modelValue":a[9]||(a[9]=s=>h.value=s),salida:w.value,"is-editing":t.value,"is-viewing":i.value,onSubmit:Y},null,8,["modelValue","salida","is-editing","is-viewing"])]))}};export{rt as default};
