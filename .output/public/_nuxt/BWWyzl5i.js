import{r as i,L as ce,y,F as S,z as x,A as e,C as F,B as M,H as Ne,I as v,J as b,E as J,M as Se,N as $e,u as Me,o as je,S as q,K as ee,X as Fe,n as I,h as te}from"#entry";import{S as De}from"./CC2Sf2Ne.js";import{_ as pe,N as Te}from"./B2AczXHm.js";import{D as ue}from"./Dx2RwFw2.js";import{_ as ze}from"./0uQ-aPjh.js";import{u as j,w as ie}from"./3SA47z_C.js";const Ie={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Ae={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Ue={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},Oe={class:"flex justify-between items-center mb-6"},He={class:"text-2xl font-bold text-gray-800"},Be={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le=["readonly","disabled"],qe=["readonly","disabled"],Je=["readonly","disabled"],Ke=["readonly","disabled"],Re=["readonly","disabled"],Ge={key:0},We=["required"],Xe=["readonly","disabled"],Qe=["readonly","disabled"],Ye={key:0,class:"flex justify-end space-x-4 mt-6"},Ze=["disabled"],_e=["disabled"],et={key:0,class:"flex items-center"},tt={key:1},ot={key:0,class:"mt-6"},at={class:"overflow-x-auto"},rt={class:"min-w-full bg-white border border-gray-300"},nt={class:"bg-white divide-y divide-gray-200"},st={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},it={class:"px-4 py-2 whitespace-nowrap text-sm"},lt=["innerHTML"],dt={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},ut={class:"px-4 py-2 whitespace-nowrap text-sm"},ct=["innerHTML"],pt={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},mt={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},gt={class:"px-4 py-2 whitespace-nowrap text-sm text-gray-900"},vt={key:1,class:"text-red-600 text-sm mt-2"},bt={__name:"ProductoModal",props:{modelValue:{type:Boolean,required:!0},producto:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(c,{emit:A}){const k=c,D=A,s=i({codigo:"",nombre:"",precio:"",nota:"",unidadMedida:"",tipoProducto:"",cantidadExistencia:0,costo:0}),C=i(""),f=i(!1),V=i(null);ce(()=>k.producto,l=>{l&&Object.keys(l).length>0?s.value={codigo:l.codigo||"",nombre:l.nombre||"",precio:l.precio||"",nota:l.nota||"",unidadMedida:l.unidadMedida||"",tipoProducto:l.tipoProducto||"",cantidadExistencia:l.cantidadExistencia||0,costo:l.costo||0}:s.value={codigo:"",nombre:"",precio:"",nota:"",unidadMedida:"",tipoProducto:"",cantidadExistencia:0,costo:0}},{immediate:!0});const T=async()=>{C.value="";const l=["codigo","nombre","precio","unidadMedida","tipoProducto","costo"];k.isEditing&&l.push("cantidadExistencia");const a=l.filter(r=>!s.value[r]);if(a.length>0){C.value="Los campos "+a.join(", ")+" son obligatorios.";return}f.value=!0,V.value={title:k.isEditing?"Guardando Producto":"Creando Producto",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((r,$)=>{D("submit",{codigo:s.value.codigo,nombre:s.value.nombre,precio:Number(s.value.precio),nota:s.value.nota,unidadMedida:s.value.unidadMedida,tipoProducto:s.value.tipoProducto,cantidadExistencia:k.isEditing?Number(s.value.cantidadExistencia):0,costo:Number(s.value.costo)}),setTimeout(r,100)})}catch(r){console.error("Error en handleSubmit:",r)}finally{setTimeout(()=>{f.value=!1,V.value=null},500)}};function E(l){if(!l)return"";let a="",r="";return l==="Facturado"?(a="bg-green-100",r="text-green-800"):l==="No Facturado"?(a="bg-yellow-100",r="text-yellow-800"):l==="Cancelado"&&(a="bg-red-100",r="text-red-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${a} ${r}">${l}</span>`}function z(l){if(!l)return"";let a="",r="";if(l==="Proveedor")a="bg-yellow-100",r="text-yellow-800";else if(l==="Cliente")a="bg-blue-100",r="text-blue-800";else return"";return`<span class="px-2 py-1 rounded-full text-sm font-medium ${a} ${r}">${l}</span>`}return(l,a)=>c.modelValue?(x(),y("div",Ie,[V.value?(x(),y("div",Ae,[F(pe,{title:V.value.title,description:V.value.description,type:V.value.type,onClose:a[0]||(a[0]=r=>V.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):S("",!0),e("div",Ue,[e("div",Oe,[e("h2",He,M(c.isViewing?"Detalles de Producto":c.isEditing?"Editar Producto":"Nuevo Producto"),1),e("button",{onClick:a[1]||(a[1]=r=>l.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...a[11]||(a[11]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:Ne(T,["prevent"]),class:"space-y-4"},[e("div",Be,[e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código",-1)),v(e("input",{"onUpdate:modelValue":a[2]||(a[2]=r=>s.value.codigo=r),type:"text",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el código del producto"},null,8,Le),[[b,s.value.codigo]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),v(e("input",{"onUpdate:modelValue":a[3]||(a[3]=r=>s.value.nombre=r),type:"text",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del producto"},null,8,qe),[[b,s.value.nombre]])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio",-1)),v(e("input",{"onUpdate:modelValue":a[4]||(a[4]=r=>s.value.precio=r),type:"number",step:"0.01",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el precio"},null,8,Je),[[b,s.value.precio]])]),e("div",null,[a[15]||(a[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Unidad de Medida",-1)),v(e("input",{"onUpdate:modelValue":a[5]||(a[5]=r=>s.value.unidadMedida=r),type:"text",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la unidad de medida"},null,8,Ke),[[b,s.value.unidadMedida]])]),e("div",null,[a[16]||(a[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Producto",-1)),v(e("input",{"onUpdate:modelValue":a[6]||(a[6]=r=>s.value.tipoProducto=r),type:"text",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el tipo de producto"},null,8,Re),[[b,s.value.tipoProducto]])]),c.isEditing||c.isViewing?(x(),y("div",Ge,[a[17]||(a[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad en Existencia",-1)),v(e("input",{"onUpdate:modelValue":a[7]||(a[7]=r=>s.value.cantidadExistencia=r),type:"number",required:c.isEditing,readonly:!0,disabled:!0,class:"w-full px-4 py-2 rounded-lg border bg-gray-100 text-gray-500 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la cantidad en existencia"},null,8,We),[[b,s.value.cantidadExistencia]])])):S("",!0),e("div",null,[a[18]||(a[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo",-1)),v(e("input",{"onUpdate:modelValue":a[8]||(a[8]=r=>s.value.costo=r),type:"number",step:"0.01",required:"",readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el costo"},null,8,Xe),[[b,s.value.costo]])])]),e("div",null,[a[19]||(a[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),v(e("textarea",{"onUpdate:modelValue":a[9]||(a[9]=r=>s.value.nota=r),readonly:c.isViewing,disabled:c.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese una nota (opcional)",rows:"3"},null,8,Qe),[[b,s.value.nota]])]),c.isViewing?S("",!0):(x(),y("div",Ye,[e("button",{type:"button",onClick:a[10]||(a[10]=r=>l.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:f.value}," Cancelar ",8,Ze),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:f.value},[f.value?(x(),y("span",et,[a[20]||(a[20]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),J(" "+M(c.isEditing?"Guardando...":"Creando..."),1)])):(x(),y("span",tt,M(c.isEditing?"Guardar Cambios":"Crear Producto"),1))],8,_e)]))],32),(c.isViewing||c.isEditing)&&k.producto.facturaProductos&&k.producto.facturaProductos.length>0?(x(),y("div",ot,[a[22]||(a[22]=e("h3",{class:"text-lg font-semibold text-gray-800 mb-4"},"Historial de Facturas",-1)),e("div",at,[e("table",rt,[a[21]||(a[21]=e("thead",null,[e("tr",{class:"bg-gray-50"},[e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"N° Consecu"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cliente/Proveedor"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Fecha"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Estado"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cantidad"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Precio Venta"),e("th",{class:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Costo Venta")])],-1)),e("tbody",nt,[(x(!0),y(Se,null,$e(k.producto.facturaProductos,r=>(x(),y("tr",{key:r.id_factura_producto},[e("td",st,M(r.factura.num_consecutivo),1),e("td",it,[e("span",{innerHTML:z(r.factura.contrato.ClienteOProveedor)},null,8,lt)]),e("td",dt,M(new Date(r.factura.fecha).toLocaleDateString()),1),e("td",ut,[e("span",{innerHTML:E(r.factura.estado)},null,8,ct)]),e("td",pt,M(r.cantidad),1),e("td",mt,M(r.precioVenta),1),e("td",gt,M(r.costoVenta),1)]))),128))])])])])):S("",!0),C.value?(x(),y("div",vt,M(C.value),1)):S("",!0)])])):S("",!0)}},ft={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},yt={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},xt={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},wt={key:2,class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},ht={class:"bg-white rounded-lg shadow-md p-4"},kt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},Ct={class:"relative"},Pt={class:"flex space-x-2"},Vt={class:"flex-1"},Et={class:"flex-1"},Nt={class:"flex justify-between items-center mb-4 mt-2"},St={class:"flex items-center gap-2 flex-wrap"},$t={key:3,class:"w-[95%] mx-auto px-4 py-4"},Mt={key:4,class:"w-[95%] mx-auto px-4 py-4"},jt={class:"bg-white rounded-lg shadow-md p-4 mb-4"},Ft={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end"},Dt={class:"flex items-center gap-2 flex-wrap"},Bt={__name:"productos",setup(c){const{navigateTo:A}=Me(),k=i(""),D=i(""),s=i(""),C=i(""),f=i(""),V=i([]),T=i(0),E=i(10),z=i(1),l=i(!1),a=i(!1),r=i(null),$=i(!1),O=i(!1),d=i(null),K=i(!1),R=i(null),P=i("productos"),G=i([]),W=i(0),H=i(1),oe=i(!1),ae=i(""),re=i(""),X=i(""),ne=i(""),Q=i(""),Y=i(""),Z=i(""),_=i(""),me=[{key:"productoCodigo",label:"Código"},{key:"productoNombre",label:"Nombre"},{key:"productoUnidad",label:"Unidad de Medida"},{key:"cantidad",label:"Cantidad"},{key:"precioVenta",label:"Precio Venta"},{key:"total",label:"Total (Cant x Precio)"},{key:"numConsecutivo",label:"N° Consecutivo factura"},{key:"fechaFactura",label:"Fecha"}],ge=[];let le={};const de=()=>{const n={nombre_producto:re.value||void 0,codigo_producto:ae.value||void 0,num_consecutivo:X.value?Number(X.value):void 0,estado:ne.value||void 0,fecha_desde:Q.value?new Date(Q.value).toISOString():void 0,fecha_hasta:Y.value?new Date(Y.value).toISOString():void 0,precio_min:Z.value!==""?Number(Z.value):void 0,precio_max:_.value!==""?Number(_.value):void 0};return Object.keys(n).forEach(t=>n[t]===void 0&&delete n[t]),n},se=async(n=H.value,t=E.value)=>{oe.value=!0;try{const o=localStorage.getItem("token"),m=I(),w=await(await fetch(`${m.public.backendHost}/FacturaProducto/filterFacturaProductos/${n}/${t}`,{method:"POST",headers:{Authorization:o,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(le)})).json(),N=Array.isArray(w.data)?w.data:[];G.value=N.map(g=>({id:g.id_factura_producto,productoCodigo:g.producto?.codigo??"",productoNombre:g.producto?.nombre??"",productoUnidad:g.producto?.unidadMedida??"",cantidad:Number(g.cantidad??0).toFixed(2),precioVenta:Number(g.precioVenta??0).toFixed(2),total:(Number(g.cantidad??0)*Number(g.precioVenta??0)).toFixed(2),numConsecutivo:g.factura?.num_consecutivo??"",fechaFactura:g.factura?.fecha?new Date(g.factura.fecha).toLocaleDateString("es-ES"):""})),W.value=w.pagination?.total||0}catch{G.value=[],W.value=0}finally{oe.value=!1}},ve=n=>{H.value=n,se(n)},be=async()=>{le=de(),H.value=1,await se(1,E.value)};ce(P,async n=>{n==="ventas"&&G.value.length===0&&await se(H.value,E.value)});async function fe(){d.value={title:"Consultando datos",description:"Se están consultando los datos de ventas, la descarga comenzará en breve.",type:"info"};try{const n=localStorage.getItem("token"),t=I(),o=de(),m=await fetch(`${t.public.backendHost}/FacturaProducto/filterFacturaProductos/1/${W.value||1e5}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json"},body:JSON.stringify(o)});if(!m.ok){const u=await m.json();d.value={title:"Error al consultar datos",description:u.error||"Ocurrió un error al consultar los datos de ventas.",type:"error"};return}const p=await m.json(),w=(Array.isArray(p.data)?p.data:[]).map(u=>({"Código Producto":u.producto?.codigo??"","Nombre Producto":u.producto?.nombre??"","Unidad de Medida":u.producto?.unidadMedida??"",Cantidad:Number(u.cantidad??0).toFixed(2),"Precio Venta":Number(u.precioVenta??0).toFixed(2),"Total (Cant x Precio)":(Number(u.cantidad??0)*Number(u.precioVenta??0)).toFixed(2),"N° Consecutivo factura":u.factura?.num_consecutivo??"","Fecha Factura":u.factura?.fecha?new Date(u.factura.fecha).toLocaleDateString("es-ES"):""})),N=j.json_to_sheet(w),g=j.book_new();j.book_append_sheet(g,N,"Ventas");const L=new Date().toISOString().split("T")[0];ie(g,`ventas_${L}.xlsx`),d.value=null}catch{d.value={title:"Error",description:"Ocurrió un error al exportar los datos de ventas.",type:"error"}}}const ye=[{key:"codigo",label:"Código"},{key:"nombre",label:"Nombre"},{key:"unidadMedida",label:"Unidad de Medida"},{key:"precio",label:"Precio"},{key:"costo",label:"Costo"},{key:"tipoProducto",label:"Tipo de Producto"},{key:"cantidadExistencia",label:"Existencia"}],xe=[{name:"Editar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:n=>{r.value=n,$.value=!0,O.value=!1,a.value=!0},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Eliminar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},handler:n=>{R.value=n,K.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],B=async(n=z.value,t=E.value)=>{l.value=!0;try{const o=localStorage.getItem("token"),m=I(),p={codigo:k.value,nombre:D.value,precio:{min:s.value?Number(s.value):void 0,max:C.value?Number(C.value):void 0},nota:f.value};!p.precio.min&&!p.precio.max?delete p.precio:(p.precio.min||delete p.precio.min,p.precio.max||delete p.precio.max);const N=await(await fetch(`${m.public.backendHost}/Producto/filterProductos/${n}/${t}`,{method:"POST",headers:{Authorization:o,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(p)})).json();V.value=Array.isArray(N.data)?N.data.map(g=>({...g,precio:Number(g.precio).toFixed(2)})):[],T.value=N.pagination?.total||0}catch{V.value=[],T.value=0}finally{l.value=!1}},we=n=>{z.value=n,B(n)},he=n=>{r.value=n,$.value=!1,O.value=!0,a.value=!0};je(()=>{B()});const ke=async n=>{try{const t=localStorage.getItem("token"),o=I(),m=$.value?`${o.public.backendHost}/Producto/updateProducto/${r.value.id_producto}`:`${o.public.backendHost}/Producto/createProducto`,p=await fetch(m,{method:$.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:t,Accept:"application/json"},body:JSON.stringify(n)});if(p.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{A("/")},3e3);return}if(p.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(p.status===400||p.status===500){const w=await p.json();w.error?d.value={title:`Errores de validación: ${p.status}`,description:w.message,type:"error"}:d.value={title:`Error: ${p.status}`,description:JSON.stringify(w),type:"error"};return}p.ok?($.value?d.value={title:`Producto Actualizado: ${p.status}`,description:`El producto ${n.nombre} se actualizó con éxito`,type:"success"}:d.value={title:`Producto Creado: ${p.status}`,description:`El producto ${n.nombre} se creó con éxito`,type:"success"},await B(z.value,E.value),a.value=!1,r.value=null,$.value=!1,O.value=!1):console.error("Error al guardar el producto")}catch(t){console.error("Error:",t),d.value={title:"Error",description:t.message,type:"error"}}},Ce=()=>{r.value=null,$.value=!1,O.value=!1,a.value=!0};async function Pe(){if(K.value=!1,!!R.value)try{const n=localStorage.getItem("token"),t=I(),o=await fetch(`${t.public.backendHost}/Producto/DeleteProducto/${R.value.id_producto}`,{method:"DELETE",headers:{Authorization:n,Accept:"application/json"}});if(o.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{A("/")},3e3);return}if(o.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!o.ok){const m=await o.json();d.value={title:`Error al eliminar: ${o.status}`,description:m.message||JSON.stringify(m),type:"error"};return}d.value={title:"Producto eliminado",description:"El producto fue eliminado correctamente",type:"success"},await B(z.value,E.value)}catch(n){d.value={title:"Error",description:n.message,type:"error"}}finally{R.value=null}}const U=async()=>{try{l.value=!0,await B(1,E.value)}catch(n){console.error("Error al buscar productos:",n)}finally{l.value=!1}};async function Ve(){d.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const n=localStorage.getItem("token"),t=I(),o={codigo:k.value,nombre:D.value,precio:{min:s.value?Number(s.value):void 0,max:C.value?Number(C.value):void 0},nota:f.value};!o.precio.min&&!o.precio.max?delete o.precio:(o.precio.min||delete o.precio.min,o.precio.max||delete o.precio.max);const m=await fetch(`${t.public.backendHost}/Producto/filterProductos/1/${T.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json"},body:JSON.stringify(o)});if(m.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{A("/")},3e3);return}if(m.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!m.ok){const u=await m.json();d.value={title:"Error al consultar datos",description:u.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const w=(await m.json()).data.map(u=>({Código:u.codigo,Nombre:u.nombre,"Unidad de Medida":u.unidadMedida,Precio:Number(u.precio).toFixed(2),Nota:u.nota})),N=j.json_to_sheet(w),g=j.book_new();j.book_append_sheet(g,N,"Productos");const L=new Date().toISOString().split("T")[0];ie(g,`productos_${L}.xlsx`),d.value=null}catch(n){console.error("Error al exportar a Excel:",n),d.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function Ee(){d.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const n=localStorage.getItem("token"),t=I(),o={codigo:k.value,nombre:D.value,precio:{min:s.value?Number(s.value):void 0,max:C.value?Number(C.value):void 0},nota:f.value};!o.precio.min&&!o.precio.max?delete o.precio:(o.precio.min||delete o.precio.min,o.precio.max||delete o.precio.max);const m=await fetch(`${t.public.backendHost}/Producto/filterProductos/1/${T.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:n,Accept:"application/json"},body:JSON.stringify(o)});if(m.status===401){d.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{A("/")},3e3);return}if(m.status===403){d.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!m.ok){const u=await m.json();d.value={title:"Error al consultar datos",description:u.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const p=await m.json(),w=[];p.data.forEach(u=>{Array.isArray(u.facturaProductos)&&u.facturaProductos.forEach(h=>{w.push({"Código Producto":u.codigo,"Nombre Producto":u.nombre,"Unidad Medida Producto":u.unidadMedida,"Precio Producto":Number(u.precio).toFixed(2),"Costo Producto":Number(u.costo).toFixed(2),"Tipo Producto":u.tipoProducto,"Existencia Producto":u.cantidadExistencia,"Nota Producto":u.nota,"Número Consecutivo Factura":h.factura.num_consecutivo,"Fecha Factura":h.factura.fecha?new Date(h.factura.fecha).toLocaleDateString("es-ES"):"","Estado Factura":h.factura.estado,"Nota Factura":h.factura.nota,Cantidad:Number(h.cantidad).toFixed(2),"Precio Venta":Number(h.precioVenta).toFixed(2),"Número Consecutivo Contrato":h.factura.contrato.num_consecutivo,"Fecha Inicio Contrato":h.factura.contrato.fecha_inicio?new Date(h.factura.contrato.fecha_inicio).toLocaleDateString("es-ES"):"","Fecha Fin Contrato":h.factura.contrato.fecha_fin?new Date(h.factura.contrato.fecha_fin).toLocaleDateString("es-ES"):"","Nota Contrato":h.factura.contrato.nota,"Cliente/Proveedor":h.factura.contrato.ClienteOProveedor,"Vigencia Facturas (Días)":h.factura.contrato.vigenciaFacturasDias})})});const N=j.json_to_sheet(w),g=j.book_new();j.book_append_sheet(g,N,"Productos con Ventas y Compras");const L=new Date().toISOString().split("T")[0];ie(g,`productos_ventas_compras_${L}.xlsx`),d.value=null}catch(n){console.error("Error al exportar a Excel con ventas y compras:",n),d.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(n,t)=>(x(),y("div",ft,[F(De,{title:"Productos - Contract Manager",description:"Registra y gestiona productos.",canonical:"/productos"}),F(Te),d.value?(x(),y("div",yt,[F(pe,{title:d.value.title,description:d.value.description,type:d.value.type,onClose:t[0]||(t[0]=o=>d.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):S("",!0),K.value?(x(),y("div",xt,[F(ze,{title:"¿Estás seguro que deseas eliminar este producto?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:Pe,onClose:t[1]||(t[1]=o=>K.value=!1)})])):S("",!0),P.value==="productos"?(x(),y("div",wt,[e("div",ht,[e("div",kt,[e("div",null,[t[21]||(t[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por código",-1)),e("div",Ct,[v(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=o=>k.value=o),placeholder:"Ingrese el código...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:q(U,["enter"])},null,544),[[b,k.value]]),t[20]||(t[20]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",null,[t[22]||(t[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[3]||(t[3]=o=>D.value=o),placeholder:"Ingrese el nombre...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:q(U,["enter"])},null,544),[[b,D.value]])]),e("div",Pt,[e("div",Vt,[t[23]||(t[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio mínimo",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[4]||(t[4]=o=>s.value=o),placeholder:"Precio min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:q(U,["enter"])},null,544),[[b,s.value]])]),e("div",Et,[t[24]||(t[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio máximo",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=o=>C.value=o),placeholder:"Precio max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:q(U,["enter"])},null,544),[[b,C.value]])])]),e("div",null,[t[25]||(t[25]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=o=>f.value=o),placeholder:"Nota...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onKeyup:q(U,["enter"])},null,544),[[b,f.value]])])]),e("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[e("button",{onClick:U,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:Ve,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...t[26]||(t[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),J(" Exportar a Excel ",-1)])]),e("button",{onClick:Ee,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...t[27]||(t[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})],-1),J(" Exportar Ventas y Compras ",-1)])])])]),e("div",Nt,[e("div",St,[e("button",{onClick:t[7]||(t[7]=o=>P.value="productos"),class:ee(["px-4 py-2 rounded-lg border transition-colors",P.value==="productos"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Productos ",2),e("button",{onClick:t[8]||(t[8]=o=>P.value="ventas"),class:ee(["px-4 py-2 rounded-lg border transition-colors",P.value==="ventas"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Ventas ",2)]),e("button",{onClick:Ce,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"},[...t[28]||(t[28]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),J(" Nuevo Producto ",-1)])])])])):S("",!0),P.value==="productos"?(x(),y("div",$t,[t[29]||(t[29]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Productos")],-1)),F(ue,{columns:ye,items:V.value,actions:xe,"total-items":T.value,"items-per-page":E.value,"current-page":z.value,"is-loading":l.value,onPageChange:we,onRowClick:he},null,8,["items","total-items","items-per-page","current-page","is-loading"])])):S("",!0),P.value==="ventas"?(x(),y("div",Mt,[t[40]||(t[40]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Ventas")],-1)),e("div",jt,[e("div",Ft,[e("div",null,[t[30]||(t[30]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Código de producto",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=o=>ae.value=o),placeholder:"Código...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,ae.value]])]),e("div",null,[t[31]||(t[31]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre de producto",-1)),v(e("input",{type:"text","onUpdate:modelValue":t[10]||(t[10]=o=>re.value=o),placeholder:"Nombre...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,re.value]])]),e("div",null,[t[32]||(t[32]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"N° consecutivo factura",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[11]||(t[11]=o=>X.value=o),placeholder:"Consecutivo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,X.value]])]),e("div",null,[t[34]||(t[34]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado factura",-1)),v(e("select",{"onUpdate:modelValue":t[12]||(t[12]=o=>ne.value=o),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},[...t[33]||(t[33]=[e("option",{value:""},"Todos",-1),e("option",{value:"Facturado"},"Facturado",-1),e("option",{value:"No Facturado"},"No Facturado",-1)])],512),[[Fe,ne.value]])]),e("div",null,[t[35]||(t[35]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha desde",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[13]||(t[13]=o=>Q.value=o),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,Q.value]])]),e("div",null,[t[36]||(t[36]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha hasta",-1)),v(e("input",{type:"date","onUpdate:modelValue":t[14]||(t[14]=o=>Y.value=o),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,Y.value]])]),e("div",null,[t[37]||(t[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio mínimo",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[15]||(t[15]=o=>Z.value=o),placeholder:"Mínimo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,Z.value]])]),e("div",null,[t[38]||(t[38]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Precio máximo",-1)),v(e("input",{type:"number","onUpdate:modelValue":t[16]||(t[16]=o=>_.value=o),placeholder:"Máximo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[b,_.value]])])]),e("div",{class:"flex justify-end gap-2 flex-wrap"},[e("button",{onClick:fe,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...t[39]||(t[39]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),J(" Exportar a Excel ",-1)])]),e("button",{onClick:be,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"},"Buscar")])]),e("div",Dt,[e("button",{onClick:t[17]||(t[17]=o=>P.value="productos"),class:ee(["px-4 py-2 rounded-lg border transition-colors",P.value==="productos"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Productos ",2),e("button",{onClick:t[18]||(t[18]=o=>P.value="ventas"),class:ee(["px-4 py-2 rounded-lg border transition-colors",P.value==="ventas"?"bg-purple-600 text-white border-purple-600 hover:bg-purple-700":"bg-white text-gray-700 border-gray-300 hover:bg-gray-100"])}," Ventas ",2)]),t[41]||(t[41]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Ventas")],-1)),F(ue,{columns:me,items:G.value,actions:ge,"total-items":W.value,"items-per-page":E.value,"current-page":H.value,"is-loading":oe.value,onPageChange:ve},null,8,["items","total-items","items-per-page","current-page","is-loading"])])):S("",!0),F(bt,{modelValue:a.value,"onUpdate:modelValue":t[19]||(t[19]=o=>a.value=o),producto:r.value,"is-editing":$.value,"is-viewing":O.value,onSubmit:ke},null,8,["modelValue","producto","is-editing","is-viewing"])]))}};export{Bt as default};
