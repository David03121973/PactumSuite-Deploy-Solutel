import{P as ct,r as d,L as X,T as mt,z as x,D as R,A as t,y as b,F as V,B as l,C as E,U as c,I as y,J as k,M as pt,N as gt,o as ft,q as z,S as P,E as Y,n as vt,h as _}from"#entry";import{_ as xt,N as bt}from"./B2AczXHm.js";import{S as yt}from"./CC2Sf2Ne.js";import{D as kt}from"./Dx2RwFw2.js";import{_ as wt}from"./BeGU4USo.js";import{_ as Z}from"./rxRbyMz-.js";import{_ as ht}from"./0uQ-aPjh.js";import{_ as Et}from"./BJDyHLIH.js";import{u as J,w as Ct}from"./3SA47z_C.js";const Nt={class:"text-lg font-semibold text-gray-900"},St={key:0,class:"space-y-6"},$t={class:"bg-gray-50 rounded-lg p-4"},At={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Pt={class:"mt-1 text-sm text-gray-900"},Vt={class:"mt-1 text-sm text-gray-900"},Ft={class:"mt-1 text-sm text-gray-900"},Tt={class:"mt-1 text-sm text-gray-900"},Dt={class:"mt-1 text-sm text-gray-900"},jt={class:"mt-1 text-sm text-gray-900"},It={class:"mt-4"},Ut={class:"mt-1 text-sm text-gray-900"},zt={class:"bg-blue-50 rounded-lg p-4"},Mt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ot={class:"mt-1 text-sm text-gray-900"},Bt={class:"mt-1 text-sm text-gray-900"},Lt={class:"mt-1 text-sm font-semibold text-gray-900"},Ht={class:"mt-1 text-sm text-gray-900"},_t={class:"mt-4"},Kt={class:"mt-1 text-sm text-gray-900"},Rt={key:0,class:"bg-green-50 rounded-lg p-4"},Jt={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qt={class:"mt-1 text-sm text-gray-900"},Gt={class:"mt-1 text-sm text-gray-900"},Qt={class:"mt-1 text-sm text-gray-900"},Wt={class:"mt-1 text-sm text-gray-900"},Xt={class:"mt-4"},Yt={class:"mt-1 text-sm text-gray-900"},Zt={key:1,class:"bg-yellow-50 rounded-lg p-4"},te={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ee={class:"mt-1 text-sm text-gray-900"},ae={class:"mt-1 text-sm text-gray-900"},oe={class:"mt-1 text-sm text-gray-900"},ne={class:"mt-1 text-sm text-gray-900"},re={class:"bg-gray-50 rounded-lg p-4"},se={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},le={class:"mt-1 text-sm text-gray-900"},ie={class:"mt-1 text-sm text-gray-900"},de={key:1,class:"space-y-6"},ue={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ce={class:"md:col-span-2"},me={key:0,class:"bg-gray-50 rounded-lg p-4"},pe={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},ge={class:"text-sm font-semibold"},fe={class:"text-sm font-semibold"},ve={class:"text-sm font-semibold"},xe={class:"text-sm font-semibold"},be={class:"text-sm font-semibold"},ye={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},ke={class:"text-sm font-semibold"},we={class:"text-sm font-semibold"},he={key:1,class:"bg-red-50 border border-red-200 text-red-700 p-3 rounded"},Ee={class:"flex justify-end gap-2"},Ce={__name:"EntradaModal",props:{modelValue:{type:Boolean,default:!1},entrada:{type:Object,default:()=>({})},isViewing:{type:Boolean,default:!0},isEditing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(r,{emit:C}){const w=r,N=C,s=ct({id_producto:null,cantidadEntrada:null,nota:"",fecha:""}),m=d(null),g=d([]);X(()=>w.entrada,u=>{u&&Object.keys(u).length?(s.id_producto=u.id_producto||u.producto?.id_producto||null,s.cantidadEntrada=u.cantidadEntrada||null,s.nota=u.nota||"",s.fecha=u.fecha?u.fecha.substring(0,10):"",m.value=u.producto||null):(s.id_producto=null,s.cantidadEntrada=null,s.nota="",s.fecha="",m.value=null)},{immediate:!0});function F(u){m.value=u}async function T(){g.value=[],s.id_producto||g.value.push("Debe seleccionar un producto"),(s.cantidadEntrada==null||Number(s.cantidadEntrada)<=0)&&g.value.push("La cantidad debe ser mayor que 0"),s.fecha||g.value.push("Debe seleccionar una fecha"),!g.value.length&&N("submit",{id_producto:s.id_producto,cantidadEntrada:Number(s.cantidadEntrada),nota:s.nota,fecha:s.fecha})}return X(()=>w.modelValue,u=>{u||(g.value=[])}),(u,e)=>(x(),mt(Et,{show:r.modelValue,onClose:e[5]||(e[5]=p=>u.$emit("update:modelValue",!1)),size:"2xl"},{title:R(()=>[t("h3",Nt,l(r.isViewing?"Detalles de la Entrada":r.isEditing?"Editar Entrada":"Nueva Entrada"),1)]),content:R(()=>[r.isViewing?(x(),b("div",St,[t("div",$t,[e[13]||(e[13]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Producto",-1)),t("div",At,[t("div",null,[e[6]||(e[6]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nombre",-1)),t("p",Pt,l(r.entrada.producto?.nombre||"N/A"),1)]),t("div",null,[e[7]||(e[7]=t("label",{class:"block text-sm font-medium text-gray-700"},"Código",-1)),t("p",Vt,l(r.entrada.producto?.codigo||"N/A"),1)]),t("div",null,[e[8]||(e[8]=t("label",{class:"block text-sm font-medium text-gray-700"},"Unidad de Medida",-1)),t("p",Ft,l(r.entrada.producto?.unidadMedida||"N/A"),1)]),t("div",null,[e[9]||(e[9]=t("label",{class:"block text-sm font-medium text-gray-700"},"Tipo de Producto",-1)),t("p",Tt,l(r.entrada.producto?.tipoProducto||"N/A"),1)]),t("div",null,[e[10]||(e[10]=t("label",{class:"block text-sm font-medium text-gray-700"},"Precio Unitario",-1)),t("p",Dt,"$"+l(Number(r.entrada.producto?.precio||0).toFixed(2)),1)]),t("div",null,[e[11]||(e[11]=t("label",{class:"block text-sm font-medium text-gray-700"},"Existencia Actual",-1)),t("p",jt,l(r.entrada.producto?.cantidadExistencia||0),1)])]),t("div",It,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nota del Producto",-1)),t("p",Ut,l(r.entrada.producto?.nota||"Sin nota"),1)])]),t("div",zt,[e[19]||(e[19]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información de la Entrada",-1)),t("div",Mt,[t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cantidad Entrada",-1)),t("p",Ot,l(r.entrada.cantidadEntrada),1)]),t("div",null,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-gray-700"},"Costo",-1)),t("p",Bt,"$"+l(Number(r.entrada.costo||0).toFixed(2)),1)]),t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-gray-700"},"Total",-1)),t("p",Lt,"$"+l((Number(r.entrada.cantidadEntrada)*Number(r.entrada.producto?.precio||0)).toFixed(2)),1)]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),t("p",Ht,l(r.entrada.fecha?new Date(r.entrada.fecha).toLocaleDateString("es-ES"):"N/A"),1)])]),t("div",_t,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nota de la Entrada",-1)),t("p",Kt,l(r.entrada.nota||"Sin nota"),1)])]),r.entrada.contrato?(x(),b("div",Rt,[e[25]||(e[25]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Contrato",-1)),t("div",Jt,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700"},"Número Consecutivo",-1)),t("p",qt,l(r.entrada.contrato?.num_consecutivo||"N/A"),1)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700"},"Cliente o Proveedor",-1)),t("p",Gt,l(r.entrada.contrato?.ClienteOProveedor||"N/A"),1)]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha Inicio",-1)),t("p",Qt,l(r.entrada.contrato?.fecha_inicio?new Date(r.entrada.contrato.fecha_inicio).toLocaleDateString("es-ES"):"N/A"),1)]),t("div",null,[e[23]||(e[23]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha Fin",-1)),t("p",Wt,l(r.entrada.contrato?.fecha_fin?new Date(r.entrada.contrato.fecha_fin).toLocaleDateString("es-ES"):"N/A"),1)])]),t("div",Xt,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700"},"Nota del Contrato",-1)),t("p",Yt,l(r.entrada.contrato?.nota||"Sin nota"),1)])])):V("",!0),r.entrada.factura?(x(),b("div",Zt,[e[30]||(e[30]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información de Factura",-1)),t("div",te,[t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-gray-700"},"Número Consecutivo",-1)),t("p",ee,l(r.entrada.factura?.num_consecutivo||"N/A"),1)]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm font-medium text-gray-700"},"Estado",-1)),t("p",ae,l(r.entrada.factura?.estado||"N/A"),1)]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm font-medium text-gray-700"},"Fecha",-1)),t("p",oe,l(r.entrada.factura?.fecha?new Date(r.entrada.factura.fecha).toLocaleDateString("es-ES"):"N/A"),1)]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm font-medium text-gray-700"},"Importe Total",-1)),t("p",ne,"$"+l(Number(r.entrada.factura?.suma_general||0).toFixed(2)),1)])])])):V("",!0),t("div",re,[e[33]||(e[33]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Sistema",-1)),t("div",se,[t("div",null,[e[31]||(e[31]=t("label",{class:"block text-sm font-medium text-gray-700"},"Creado",-1)),t("p",le,l(r.entrada.createdAt?new Date(r.entrada.createdAt).toLocaleString("es-ES"):"N/A"),1)]),t("div",null,[e[32]||(e[32]=t("label",{class:"block text-sm font-medium text-gray-700"},"Última Actualización",-1)),t("p",ie,l(r.entrada.updatedAt?new Date(r.entrada.updatedAt).toLocaleString("es-ES"):"N/A"),1)])])])])):(x(),b("div",de,[t("div",ue,[t("div",null,[e[34]||(e[34]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto",-1)),E(Z,{modelValue:c(s).id_producto,"onUpdate:modelValue":e[0]||(e[0]=p=>c(s).id_producto=p),endpoint:"/Producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto",placeholder:"Buscar producto...",onProductoSeleccionado:F},null,8,["modelValue"])]),t("div",null,[e[35]||(e[35]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),y(t("input",{type:"date","onUpdate:modelValue":e[1]||(e[1]=p=>c(s).fecha=p),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[k,c(s).fecha]])]),t("div",null,[e[36]||(e[36]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad",-1)),y(t("input",{type:"number","onUpdate:modelValue":e[2]||(e[2]=p=>c(s).cantidadEntrada=p),min:"0",step:"0.01",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary"},null,512),[[k,c(s).cantidadEntrada,void 0,{number:!0}]])]),t("div",ce,[e[37]||(e[37]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),y(t("input",{type:"text","onUpdate:modelValue":e[3]||(e[3]=p=>c(s).nota=p),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",placeholder:"Nota..."},null,512),[[k,c(s).nota]])])]),c(m)?(x(),b("div",me,[e[45]||(e[45]=t("h4",{class:"text-md font-medium text-gray-900 mb-3"},"Información del Producto",-1)),t("div",pe,[t("div",null,[e[38]||(e[38]=t("div",{class:"text-sm text-gray-600"},"Existencia",-1)),t("div",ge,l(c(m).cantidadExistencia),1)]),t("div",null,[e[39]||(e[39]=t("div",{class:"text-sm text-gray-600"},"Unidad",-1)),t("div",fe,l(c(m).unidadMedida),1)]),t("div",null,[e[40]||(e[40]=t("div",{class:"text-sm text-gray-600"},"Tipo",-1)),t("div",ve,l(c(m).tipoProducto),1)]),t("div",null,[e[41]||(e[41]=t("div",{class:"text-sm text-gray-600"},"Precio",-1)),t("div",xe,l(Number(c(m).precio||0).toFixed(2)),1)]),t("div",null,[e[42]||(e[42]=t("div",{class:"text-sm text-gray-600"},"Costo",-1)),t("div",be,l(Number(c(m).costo||0).toFixed(2)),1)])]),t("div",ye,[t("div",null,[e[43]||(e[43]=t("div",{class:"text-sm text-gray-600"},"Precio × Cantidad",-1)),t("div",ke,l((Number(c(m).precio||0)*Number(c(s).cantidadEntrada||0)).toFixed(2)),1)]),t("div",null,[e[44]||(e[44]=t("div",{class:"text-sm text-gray-600"},"Costo × Cantidad",-1)),t("div",we,l((Number(c(m).costo||0)*Number(c(s).cantidadEntrada||0)).toFixed(2)),1)])])])):V("",!0),c(g).length?(x(),b("div",he,[(x(!0),b(pt,null,gt(c(g),(p,S)=>(x(),b("div",{key:S},l(p),1))),128))])):V("",!0)]))]),footer:R(()=>[t("div",Ee,[r.isViewing?V("",!0):(x(),b("button",{key:0,onClick:T,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90"},l(r.isEditing?"Guardar":"Crear"),1)),t("button",{onClick:e[4]||(e[4]=p=>u.$emit("update:modelValue",!1)),class:"px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400"},"Cerrar")])]),_:1},8,["show"]))}},Ne={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Se={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},$e={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Ae={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Pe={class:"bg-white rounded-lg shadow-md p-4"},Ve={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},Fe={class:"w-full"},Te={class:"w-full"},De={class:"w-full"},je={class:"w-full"},Ie={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},Ue={class:"w-full"},ze={class:"w-full"},Me={class:"w-full md:col-span-2"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Be={class:"w-full"},Le={class:"w-full"},He={class:"w-[95%] mx-auto px-4 py-4"},Ye={__name:"entradas",setup(r){const C=d(""),w=d(""),N=d(""),s=d(""),m=d(""),g=d(""),F=d(""),T=d(""),u=d(""),e=d([]),p=d(!1),S=d({}),M=d(!1),A=d(!1),O=d(!1),B=d(null),tt=[{key:"producto.nombre",label:"Producto"},{key:"producto.codigo",label:"Código"},{key:"producto.unidadMedida",label:"Unidad"},{key:"cantidadEntrada",label:"Cantidad"},{key:"producto.precio",label:"Precio Unitario",cellRenderer:o=>{if(o==null||o==="")return"";const a=parseFloat(o);return isNaN(a)?o:`<span class="px-2 py-1 rounded text-sm">${a.toFixed(2)}</span>`}},{key:"total",label:"Total",cellRenderer:(o,a)=>{const n=parseFloat(a.cantidadEntrada||0),f=parseFloat(a.producto?.precio||0);return`<span class="px-2 py-1 rounded text-sm font-semibold">${(n*f).toFixed(2)}</span>`}},{key:"fecha",label:"Fecha",cellRenderer:o=>o?`<span class="px-2 py-1 rounded text-sm">${o.substring(0,10)}</span>`:""}],L=d(1),K=d(0),j=d(!1),q=d(20),G=d([]),i=d(null),D=vt(),Q={render(){return _("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[_("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},et=[{name:"Editar",icon:{render(){return _("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[_("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:o=>W(o,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90",visible:o=>!o.id_contrato&&!o.id_factura||o.id_contrato===""&&o.id_factura===""},{name:"Eliminar",icon:Q,handler:o=>rt(o),iconOnly:!1,buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90",visible:o=>!o.id_contrato&&!o.id_factura||o.id_contrato===""&&o.id_factura===""}];async function at(){try{const o=localStorage.getItem("token"),n=await(await fetch(`${D.public.backendHost}/contrato`,{method:"GET",headers:{Authorization:o,Accept:"application/json"}})).json();e.value=Array.isArray(n.data)?n.data.map(f=>({...f,displayLabel:`${f.num_consecutivo} - ${f.entidad?.nombre||""} - ${f.tipoContrato?.nombre||""}`})):[]}catch(o){console.error("Error al cargar contratos:",o)}}async function I(o=1){const a=localStorage.getItem("token");if(!a){z("/");return}try{j.value=!0;const n={nota:F.value||"",fecha_desde:T.value||"",fecha_hasta:u.value||""};C.value!==""&&(n.id_producto=C.value),w.value!==""&&(n.id_contrato=w.value),(N.value!==""||s.value!=="")&&(n.cantidadEntrada={min:N.value||0,max:s.value||0}),(m.value!==""||g.value!=="")&&(n.costo={min:m.value||0,max:g.value||0}),console.log(n);const f=await fetch(`${D.public.backendHost}/entrada/filterEntradas/${o}/${q.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify(n)});if(f.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{z("/")},3e3);return}if(f.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const h=await f.json();G.value=h.data||[],K.value=h.pagination?.total||0,L.value=h.pagination?.currentPage||1}catch{i.value={title:"Error",description:"No se pudieron cargar las entradas",type:"error"}}finally{j.value=!1}}function W(o,a){if((o.id_factura||o.id_contrato)&&a!=="ver"){i.value={title:"Entrada no editable",description:"Esta entrada fue creada por una factura de un proveedor, solo es editable desde la factura misma",type:"warning"};return}S.value={...o},M.value=a==="ver",A.value=a==="editar",p.value=!0}function ot(o){W(o,"ver")}function nt(){S.value=null,M.value=!1,A.value=!1,p.value=!0}function rt(o){if(o.id_factura||o.id_contrato){i.value={title:"Entrada no eliminable",description:"Esta entrada fue creada por una factura de un proveedor, solo es eliminable desde la factura misma",type:"warning"};return}B.value=o,O.value=!0}async function st(){if(B.value)try{const o=localStorage.getItem("token"),a=await fetch(`${D.public.backendHost}/Entrada/deleteEntrada/${B.value.id_entrada}`,{method:"DELETE",headers:{Authorization:o,Accept:"application/json"}});if(a.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{z("/")},3e3);return}if(a.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!a.ok){const n=await a.json().catch(()=>({})),f=Array.isArray(n.errors)?n.errors.join(`
`):n.error||"No se pudo eliminar la entrada";i.value={title:"Error",description:f,type:"error"};return}i.value={title:"Entrada eliminada",description:"Se eliminó correctamente",type:"success"},await I(L.value)}catch{i.value={title:"Error",description:"Ocurrió un error al eliminar",type:"error"}}finally{O.value=!1,B.value=null}}async function lt(o){try{const a=localStorage.getItem("token"),n=A.value&&S.value?.id_entrada?`${D.public.backendHost}/Entrada/updateEntrada/${S.value.id_entrada}`:`${D.public.backendHost}/Entrada/createEntrada`,f=A.value?"PUT":"POST",h=await fetch(n,{method:f,headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(o)});if(!h.ok){const U=await h.json().catch(()=>({})),H=Array.isArray(U.errors)?U.errors.join(`
`):U.error||"Error en la operación";i.value={title:"Error",description:H,type:"error"};return}i.value={title:A.value?"Entrada actualizada":"Entrada creada",description:"Operación exitosa",type:"success"},p.value=!1,S.value={},A.value=!1,M.value=!1,await I(L.value)}catch{i.value={title:"Error",description:"Ocurrió un error al guardar",type:"error"}}}const $=async()=>{try{j.value=!0,await I(1)}catch(o){console.error("Error al buscar entradas:",o)}finally{j.value=!1}};function it(o){I(o)}async function dt(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const o=localStorage.getItem("token"),a={nota:F.value||"",fecha_desde:T.value||"",fecha_hasta:u.value||""};C.value!==""&&(a.id_producto=C.value),w.value!==""&&(a.id_contrato=w.value),(N.value!==""||s.value!=="")&&(a.cantidadEntrada={min:N.value||0,max:s.value||0}),(m.value!==""||g.value!=="")&&(a.costo={min:m.value||0,max:g.value||0});const n=await fetch(`${D.public.backendHost}/entrada/filterEntradas/1/${K.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:o,Accept:"application/json"},body:JSON.stringify(a)});if(n.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{z("/")},3e3);return}if(n.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!n.ok){const v=await n.json();i.value={title:"Error al consultar datos",description:v.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const h=(await n.json()).data.map(v=>({Producto:v.producto?.nombre||"",Código:v.producto?.codigo||"",Unidad:v.producto?.unidadMedida||"",Cantidad:v.cantidadEntrada,"Precio Unitario":Number(v.producto?.precio||0).toFixed(2),Total:(Number(v.cantidadEntrada)*Number(v.producto?.precio||0)).toFixed(2),Fecha:v.fecha?v.fecha.substring(0,10):"",Nota:v.nota||"",Contrato:v.contrato?.num_consecutivo||"",Entidad:v.contrato?.entidad?.nombre||""})),U=J.json_to_sheet(h),H=J.book_new();J.book_append_sheet(H,U,"Entradas");const ut=new Date().toISOString().split("T")[0];Ct(H,`entradas_${ut}.xlsx`),i.value=null}catch(o){console.error("Error al exportar a Excel:",o),i.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return ft(async()=>{if(!localStorage.getItem("token")){z("/");return}await at(),await I()}),(o,a)=>(x(),b("div",Ne,[E(yt,{title:"Entradas - Pactum",description:"Lista y gestión de entradas de productos.",canonical:"/entradas"}),E(bt),i.value?(x(),b("div",Se,[E(xt,{title:i.value.title,description:i.value.description,type:i.value.type,onClose:a[0]||(a[0]=n=>i.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):V("",!0),O.value?(x(),b("div",$e,[E(ht,{title:"¿Estás seguro que deseas eliminar esta entrada?",description:"Esta acción no se puede deshacer.",icon:Q,type:"warning",onConfirm:st,onClose:a[1]||(a[1]=n=>O.value=!1)})])):V("",!0),t("div",Ae,[t("div",Pe,[t("div",Ve,[t("div",Fe,[a[12]||(a[12]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Producto por código",-1)),E(Z,{modelValue:C.value,"onUpdate:modelValue":a[2]||(a[2]=n=>C.value=n),endpoint:"/Producto/filterProductos/1/10",method:"POST","search-key":"codigo","label-key":"codigo","value-key":"id_producto",placeholder:"Buscar producto por código..."},null,8,["modelValue"])]),t("div",Te,[a[13]||(a[13]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato por número consecutivo",-1)),E(wt,{modelValue:w.value,"onUpdate:modelValue":a[3]||(a[3]=n=>w.value=n),options:e.value,labelKey:"displayLabel",valueKey:"id_contrato",placeholder:"Buscar contrato..."},null,8,["modelValue","options"])]),t("div",De,[a[14]||(a[14]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad mínima",-1)),y(t("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=n=>N.value=n),placeholder:"Cantidad min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,N.value,void 0,{number:!0}]])]),t("div",je,[a[15]||(a[15]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cantidad máxima",-1)),y(t("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=n=>s.value=n),placeholder:"Cantidad max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,s.value,void 0,{number:!0}]])])]),t("div",Ie,[t("div",Ue,[a[16]||(a[16]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo mínimo",-1)),y(t("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=n=>m.value=n),step:"0.01",placeholder:"Costo min...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,m.value,void 0,{number:!0}]])]),t("div",ze,[a[17]||(a[17]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Costo máximo",-1)),y(t("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=n=>g.value=n),step:"0.01",placeholder:"Costo max...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,g.value,void 0,{number:!0}]])]),t("div",Me,[a[18]||(a[18]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),y(t("input",{type:"text","onUpdate:modelValue":a[8]||(a[8]=n=>F.value=n),placeholder:"Nota...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,F.value]])])]),t("div",Oe,[t("div",Be,[a[19]||(a[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha desde",-1)),y(t("input",{type:"date","onUpdate:modelValue":a[9]||(a[9]=n=>T.value=n),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,T.value]])]),t("div",Le,[a[20]||(a[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha hasta",-1)),y(t("input",{type:"date","onUpdate:modelValue":a[10]||(a[10]=n=>u.value=n),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:P($,["enter"])},null,544),[[k,u.value]])])]),t("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[t("button",{onClick:$,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),t("button",{onClick:dt,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[21]||(a[21]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),Y(" Exportar a Excel ",-1)])])])])]),t("div",He,[t("div",{class:"flex justify-between items-center mb-4"},[a[23]||(a[23]=t("h2",{class:"text-2xl font-bold"},"Entradas",-1)),t("button",{onClick:nt,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...a[22]||(a[22]=[t("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),Y(" Nueva Entrada ",-1)])])]),E(kt,{columns:tt,items:G.value,actions:et,"total-items":K.value,"items-per-page":q.value,"current-page":L.value,"is-loading":j.value,onPageChange:it,onRowClick:ot},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),E(Ce,{modelValue:p.value,"onUpdate:modelValue":a[11]||(a[11]=n=>p.value=n),entrada:S.value,"is-editing":A.value,"is-viewing":M.value,onSubmit:lt},null,8,["modelValue","entrada","is-editing","is-viewing"])]))}};export{Ye as default};
