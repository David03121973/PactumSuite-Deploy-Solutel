import{u as T,r as c,o as D,y,C as d,F as E,A as e,I as N,J as j,S as I,n as b,z as x}from"#entry";import{S as A}from"./CC2Sf2Ne.js";import{_ as M,N as z}from"./B2AczXHm.js";import{D as B}from"./Dx2RwFw2.js";import{u as m,w as O}from"./3SA47z_C.js";const F={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},$={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},P={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},V={class:"bg-white rounded-lg shadow-md p-4"},J={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},U={class:"relative"},H={class:"w-[95%] mx-auto px-4 py-4"},W={__name:"servicios",setup(K){const{navigateTo:h}=T(),n=c(""),l=c([]),u=c(!1),o=c(null),w=[{key:"descripcion",label:"Descripción"},{key:"importe",label:"Importe"},{key:"cantidad",label:"Cantidad"},{key:"importe_total",label:"Importe Total"},{key:"unidadMedida",label:"Unidad de Medida"},{key:"factura.num_consecutivo",label:"Número Consecutivo Factura"}],v=async()=>{u.value=!0;try{const r=localStorage.getItem("token"),t=b(),a={descripcion:n.value},p=await(await fetch(`${t.public.backendHost}/Servicio/filter`,{method:"POST",headers:{Authorization:r,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(a)})).json();l.value=Array.isArray(p)?p:[]}catch{l.value=[],o.value={title:"Error",description:"Error al cargar los servicios.",type:"error"}}finally{u.value=!1}};D(()=>{v()});const f=async()=>{try{await v()}catch(r){console.error("Error al buscar servicios:",r)}};async function k(){o.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const r=localStorage.getItem("token"),t=b(),a={descripcion:n.value},i=await fetch(`${t.public.backendHost}/Servicio/filter`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:r,Accept:"application/json"},body:JSON.stringify(a)});if(i.status===401){o.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{h("/")},3e3);return}if(i.status===403){o.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!i.ok){const s=await i.json();o.value={title:"Error al consultar datos",description:s.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const _=(await i.json()).map(s=>({Descripción:s.descripcion,Importe:Number(s.importe).toFixed(2),Cantidad:s.cantidad,"Importe Total":Number(s.importe_total).toFixed(2),"Unidad de Medida":s.unidadMedida,"Número Consecutivo Factura":s.factura?.num_consecutivo||""})),S=m.json_to_sheet(_),g=m.book_new();m.book_append_sheet(g,S,"Servicios");const C=new Date().toISOString().split("T")[0];O(g,`servicios_${C}.xlsx`),o.value=null}catch(r){console.error("Error al exportar a Excel:",r),o.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(r,t)=>(x(),y("div",F,[d(A,{title:"Servicios - Pactum",description:"Lista de servicios.",canonical:"/servicios"}),d(z),o.value?(x(),y("div",$,[d(M,{title:o.value.title,description:o.value.description,type:o.value.type,onClose:t[0]||(t[0]=a=>o.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):E("",!0),e("div",P,[e("div",V,[e("div",J,[e("div",null,[t[3]||(t[3]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por descripción",-1)),e("div",U,[N(e("input",{type:"text","onUpdate:modelValue":t[1]||(t[1]=a=>n.value=a),placeholder:"Ingrese la descripción...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:I(f,["enter"])},null,544),[[j,n.value]]),t[2]||(t[2]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])])]),e("div",{class:"flex justify-end mt-4 gap-2"},[e("button",{onClick:f,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:k,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors"}," Exportar a Excel ")])])]),e("div",H,[t[4]||(t[4]=e("div",{class:"flex justify-between items-center mb-4"},[e("h2",{class:"text-2xl font-bold"},"Servicios")],-1)),d(B,{columns:w,items:l.value,"total-items":l.value.length,"items-per-page":1e3,"current-page":1,"is-loading":u.value},null,8,["items","total-items","is-loading"])])]))}};export{W as default};
