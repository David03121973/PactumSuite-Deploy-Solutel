import{r as i,L as ue,k as se,y as b,F as P,z as y,A as e,C as S,B as k,H as ye,I as J,J as G,E as R,o as fe,Q as xe,W as he,n as U,M as ve,N as pe,q as me,u as we,S as de,h as te}from"#entry";import{S as ke}from"./CC2Sf2Ne.js";import{_ as ce,N as Ce}from"./B2AczXHm.js";import{D as be}from"./Dx2RwFw2.js";import{_ as ae}from"./BeGU4USo.js";import{_ as je}from"./0uQ-aPjh.js";import{u as oe,w as ge}from"./3SA47z_C.js";const _e={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},Te={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Se={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},Ee={class:"flex justify-between items-center mb-6"},Ae={class:"text-2xl font-bold text-gray-800"},$e={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ve=["readonly","disabled"],ze=["readonly","disabled"],Ie=["readonly","disabled"],De=["readonly","disabled"],Me={class:"mt-4"},Ne={key:0,class:"flex justify-end space-x-4 mt-6"},Oe=["disabled"],Pe=["disabled"],Be={key:0,class:"flex items-center"},Fe={key:1},He={key:0,class:"mt-8"},Le={key:1,class:"text-red-600 text-sm mt-2"},Ue=5,Ke={__name:"TrabajadorModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1}},emits:["update:modelValue","submit"],setup(m,{emit:K}){const j=m,B=K,d=i({nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}),I=i([{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),_=i(""),f=i(!1),w=i(null);ue(()=>j.trabajador,r=>{r&&Object.keys(r).length>0?d.value={nombre:r.nombre||"",cargo:r.cargo||"",carnet_identidad:r.carnet_identidad||"",num_telefono:r.num_telefono||"",firma:r.funcion||""}:d.value={nombre:"",cargo:"",carnet_identidad:"",num_telefono:"",firma:""}},{immediate:!0});const D=async()=>{if(_.value="",!d.value.nombre||!d.value.carnet_identidad||!d.value.firma){_.value="Todos los campos son obligatorios.";return}f.value=!0,w.value={title:j.isEditing?"Guardando Trabajador":"Creando Trabajador",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{await new Promise((r,n)=>{B("submit",{nombre:d.value.nombre,cargo:d.value.cargo,carnet_identidad:d.value.carnet_identidad,num_telefono:d.value.num_telefono,funcion:d.value.firma}),setTimeout(r,100)})}catch(r){console.error("Error en handleSubmit:",r)}finally{setTimeout(()=>{f.value=!1,w.value=null},500)}},M=r=>{let n=r.target.value.replace(/\D/g,"");n.length>11&&(n=n.slice(0,11)),d.value.carnet_identidad=n},A=r=>{let n=r.target.value;n=n.replace(/[^0-9+\-]/g,""),d.value.num_telefono=n},p=[{key:"id_contrato",label:"ID Contrato"},{key:"fecha_inicio",label:"Fecha de Inicio"},{key:"fecha_fin",label:"Fecha de Fin"},{key:"entidad_nombre",label:"Entidad"},{key:"tipo_contrato_nombre",label:"Tipo de Contrato"}],N=se(()=>!j.trabajador||!Array.isArray(j.trabajador.contratos)?[]:j.trabajador.contratos.map(r=>({id_contrato:r.id_contrato,fecha_inicio:r.fecha_inicio?r.fecha_inicio.split("T")[0]:"",fecha_fin:r.fecha_fin?r.fecha_fin.split("T")[0]:"",entidad_nombre:r.entidad?.nombre||"",tipo_contrato_nombre:r.tipoContrato?.nombre||""}))),F=se(()=>N.value.length),x=i(1),C=r=>{x.value=r};return(r,n)=>m.modelValue?(y(),b("div",_e,[w.value?(y(),b("div",Te,[S(ce,{title:w.value.title,description:w.value.description,type:w.value.type,onClose:n[0]||(n[0]=s=>w.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),e("div",Se,[e("div",Ee,[e("h2",Ae,k(m.isViewing?"Detalles de Trabajador":m.isEditing?"Editar Trabajador":"Nuevo Trabajador"),1),e("button",{onClick:n[1]||(n[1]=s=>r.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...n[8]||(n[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:ye(D,["prevent"]),class:"space-y-4"},[e("div",$e,[e("div",null,[n[9]||(n[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre",-1)),J(e("input",{"onUpdate:modelValue":n[2]||(n[2]=s=>d.value.nombre=s),type:"text",required:"",readonly:m.isViewing,disabled:m.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre del trabajador"},null,8,Ve),[[G,d.value.nombre]])]),e("div",null,[n[10]||(n[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo",-1)),J(e("input",{"onUpdate:modelValue":n[3]||(n[3]=s=>d.value.cargo=s),type:"text",readonly:m.isViewing,disabled:m.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el cargo"},null,8,ze),[[G,d.value.cargo]])]),e("div",null,[n[11]||(n[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),J(e("input",{"onUpdate:modelValue":n[4]||(n[4]=s=>d.value.carnet_identidad=s),type:"text",required:"",readonly:m.isViewing,disabled:m.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el carnet de identidad",maxlength:"11",onInput:M},null,40,Ie),[[G,d.value.carnet_identidad]])]),e("div",null,[n[12]||(n[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),J(e("input",{"onUpdate:modelValue":n[5]||(n[5]=s=>d.value.num_telefono=s),type:"text",readonly:m.isViewing,disabled:m.isViewing||f.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el número de teléfono",onInput:A},null,40,De),[[G,d.value.num_telefono]])])]),e("div",Me,[n[13]||(n[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),S(ae,{modelValue:d.value.firma,"onUpdate:modelValue":n[6]||(n[6]=s=>d.value.firma=s),options:I.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función...",readonly:m.isViewing,disabled:m.isViewing||f.value,required:""},null,8,["modelValue","options","readonly","disabled"])]),m.isViewing?P("",!0):(y(),b("div",Ne,[e("button",{type:"button",onClick:n[7]||(n[7]=s=>r.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:f.value}," Cancelar ",8,Oe),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:f.value},[f.value?(y(),b("span",Be,[n[14]||(n[14]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),R(" "+k(m.isEditing?"Guardando...":"Creando..."),1)])):(y(),b("span",Fe,k(m.isEditing?"Guardar Cambios":"Crear Trabajador"),1))],8,Pe)]))],32),m.isViewing||m.isEditing?(y(),b("div",He,[n[15]||(n[15]=e("h3",{class:"text-lg font-semibold mb-2"},"Contratos Asociados",-1)),S(be,{columns:p,items:N.value,"total-items":F.value,"items-per-page":Ue,"current-page":x.value,"is-loading":!1,"show-actions":!1,onPageChange:C},null,8,["items","total-items","current-page"])])):P("",!0),_.value?(y(),b("div",Le,k(_.value),1)):P("",!0)])])):P("",!0)}},qe={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Je={class:"bg-white rounded-lg w-full max-w-7xl max-h-[90vh] overflow-hidden flex flex-col"},Ge={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Re={class:"p-6 border-b border-gray-200"},We={class:"flex justify-between items-center mb-4"},Qe={key:0,class:"text-sm text-gray-600 mt-1"},Ye={class:"font-medium"},Xe={class:"font-medium"},Ze={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},et={class:"flex-1 flex overflow-hidden"},tt={key:0,class:"flex justify-center items-center py-8"},ot={key:1,class:"space-y-2"},at=["onClick"],nt={class:"flex items-center justify-between"},rt={class:"flex-1"},st={class:"font-bold text-gray-900"},it={class:"text-sm text-gray-600"},lt={class:"text-sm text-gray-600"},dt={class:"text-xs text-gray-500"},ut={key:0,class:"flex justify-center items-center py-4"},ct={class:"w-1/2 p-4 overflow-y-auto"},vt={class:"space-y-2"},pt=["onClick"],mt={class:"flex items-center justify-between"},gt={class:"flex-1"},ft={class:"font-bold text-gray-900"},bt={class:"text-sm text-gray-600"},yt={class:"text-sm text-gray-600"},xt={class:"text-xs text-gray-500"},ht={class:"p-4 border-t border-gray-200 bg-gray-50"},wt={class:"flex justify-between items-center"},kt={class:"text-sm text-gray-600"},Ct={class:"font-medium"},jt={class:"font-medium"},_t={class:"flex space-x-3"},Tt={__name:"TrabajadorAsociacionModal",props:{modelValue:{type:Boolean,required:!0},trabajador:{type:Object,default:()=>({})},entidades:{type:Array,default:()=>[]}},emits:["update:modelValue","save-associations"],setup(m,{emit:K}){const j=m,B=K,d=se(()=>j.trabajador),I=i(!1),_=i(!1),f=i([]),w=i([]),D=i(1),M=i(!0),A=i(null),p=i({numConsecutivo:"",entidad:null,tipoContrato:null}),N=se(()=>j.entidades.map(u=>({value:u.id_entidad,label:u.nombre}))),F=i([]),x=i([]),C=i([]),r=i([]),n=u=>u?new Date(u).toLocaleDateString("es-ES"):"Sin fecha",s=async(u=1,t=!1)=>{u===1?I.value=!0:_.value=!0;try{const o=localStorage.getItem("token"),V=U(),E={},Q=await fetch(`${V.public.backendHost}/contrato/filter/${u}/700`,{method:"POST",headers:{Authorization:o,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(E)});if(Q.status===401||Q.status===403){$.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{me("/")},3e3);return}const z=await Q.json();if(z.data&&Array.isArray(z.data)){if(t){const O=[...x.value,...z.data];x.value=O}else x.value=z.data;if(!t)d.value&&d.value.contratos?C.value=d.value.contratos.map(O=>O.id_contrato):C.value=[],r.value=x.value.map(O=>O.id_contrato).filter(O=>!C.value.includes(O));else{const O=z.data.map(Y=>Y.id_contrato).filter(Y=>!C.value.includes(Y));r.value.push(...O.filter(Y=>!r.value.includes(Y)))}ee(),z.pagination&&(M.value=z.pagination.hasNextPage,D.value=z.pagination.currentPage)}else t||(f.value=[],w.value=[])}catch(o){console.error("Error al cargar contratos:",o),t||(f.value=[],w.value=[])}finally{I.value=!1,_.value=!1}},Z=async()=>{M.value&&!_.value&&await s(D.value+1,!0)},W=async u=>{const{scrollTop:t,scrollHeight:o,clientHeight:V}=u.target;o-t-V<100&&await Z()},ne=(u,t)=>{if(t==="izquierda"){const o=r.value.indexOf(u.id_contrato);o!==-1&&(r.value.splice(o,1),C.value.push(u.id_contrato),ee())}else{const o=C.value.indexOf(u.id_contrato);o!==-1&&(C.value.splice(o,1),r.value.push(u.id_contrato),ee())}},$=i(null),ie=async()=>{const u=localStorage.getItem("token"),t=U(),o=d.value?.id_trabajador_autorizado,V=C.value;if(!o){$.value={title:"Error",description:"No se encontró el ID del trabajador.",type:"error"};return}if(!u){window.location.href="/";return}try{const E=await fetch(`${t.public.backendHost}/contratoTrabajador/syncTrabajadorContratos`,{method:"POST",headers:{Authorization:u,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({id_trabajador_autorizado:o,ids_contratos:V})});if(E.status===401||E.status===403){$.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{me("/")},3e3);return}if(E.ok)$.value={title:"¡Asociaciones guardadas correctamente!",description:"Las asociaciones del trabajador fueron actualizadas.",type:"success"},setTimeout(()=>{B("update:modelValue",!1),B("save-associations",{id_trabajador_autorizado:o,ids_contratos:V}),$.value=null},1200);else{const Q=await E.json();$.value={title:"Error al guardar asociaciones",description:Q.message||E.status,type:"error"}}}catch(E){$.value={title:"Error de red al guardar asociaciones",description:E.message,type:"error"}}};function ee(){let u=x.value.filter(o=>r.value.includes(o.id_contrato)),t=x.value.filter(o=>C.value.includes(o.id_contrato));p.value.numConsecutivo&&(u=u.filter(o=>String(o.num_consecutivo).includes(String(p.value.numConsecutivo))),t=t.filter(o=>String(o.num_consecutivo).includes(String(p.value.numConsecutivo)))),p.value.entidad&&(u=u.filter(o=>String(o.entidad?.id_entidad)===String(p.value.entidad)),t=t.filter(o=>String(o.entidad?.id_entidad)===String(p.value.entidad))),p.value.tipoContrato&&(u=u.filter(o=>String(o.tipoContrato?.id_tipo_contrato)===String(p.value.tipoContrato)),t=t.filter(o=>String(o.tipoContrato?.id_tipo_contrato)===String(p.value.tipoContrato))),f.value=u,w.value=t}ue(p,u=>{ee()},{deep:!0}),ue(()=>j.modelValue,async u=>{u&&(await q(),re())}),fe(async()=>{j.modelValue&&re(),await xe(),A.value&&A.value.addEventListener("scroll",W)}),he(()=>{A.value&&A.value.removeEventListener("scroll",W)});const q=async()=>{try{const u=localStorage.getItem("token"),t=U(),V=await(await fetch(`${t.public.backendHost}/tipoContrato`,{method:"GET",headers:{Authorization:u,Accept:"application/json"}})).json();F.value=Array.isArray(V.data)?V.data.map(E=>({value:E.id_tipo_contrato,label:E.nombre})):[]}catch{F.value=[]}},re=()=>{D.value=1,M.value=!0,f.value=[],w.value=[],x.value=[],r.value=[],C.value=[],s(1,!1)};return(u,t)=>m.modelValue?(y(),b("div",qe,[e("div",Je,[$.value?(y(),b("div",Ge,[S(ce,{title:$.value.title,description:$.value.description,type:$.value.type,onClose:t[0]||(t[0]=o=>$.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),e("div",Re,[e("div",We,[e("div",null,[t[8]||(t[8]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Asociar Trabajador a Contratos",-1)),d.value?(y(),b("p",Qe,[t[6]||(t[6]=R(" Trabajador: ",-1)),e("span",Ye,k(d.value.nombre),1),t[7]||(t[7]=R(" - ",-1)),e("span",Xe,k(d.value.cargo),1)])):P("",!0)]),e("button",{onClick:t[1]||(t[1]=o=>u.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[9]||(t[9]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",Ze,[e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número consecutivo",-1)),J(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>p.value.numConsecutivo=o),type:"number",min:"0",class:"w-full px-3 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Buscar por número..."},null,512),[[G,p.value.numConsecutivo]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),S(ae,{modelValue:p.value.entidad,"onUpdate:modelValue":t[3]||(t[3]=o=>p.value.entidad=o),options:N.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar entidad...",class:"w-full"},null,8,["modelValue","options"])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo de Contrato",-1)),S(ae,{modelValue:p.value.tipoContrato,"onUpdate:modelValue":t[4]||(t[4]=o=>p.value.tipoContrato=o),options:F.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar tipo...",class:"w-full"},null,8,["modelValue","options"])])])]),e("div",et,[e("div",{class:"w-1/2 border-r border-gray-200 p-4 overflow-y-auto",ref_key:"scrollContainer",ref:A},[t[16]||(t[16]=e("h3",{class:"text-lg font-semibold mb-4 text-primary"},"Contratos Existentes",-1)),I.value&&f.value.length===0?(y(),b("div",tt,[...t[13]||(t[13]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"},null,-1)])])):(y(),b("div",ot,[(y(!0),b(ve,null,pe(f.value,o=>(y(),b("div",{key:o.id_contrato,onClick:V=>ne(o,"izquierda"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-accent/10 hover:border-accent/40 transition-colors"},[e("div",nt,[e("div",rt,[e("h4",st,k(o.entidad?.nombre||"Sin entidad"),1),e("p",it,"N° "+k(o.num_consecutivo),1),e("p",lt,k(o.tipoContrato?.nombre||"Sin tipo"),1),e("p",dt,k(n(o.fecha_inicio))+" - "+k(n(o.fecha_fin)),1)]),t[14]||(t[14]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 5l7 7-7 7"})],-1))])],8,at))),128)),_.value?(y(),b("div",ut,[...t[15]||(t[15]=[e("div",{class:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-500"},null,-1)])])):P("",!0)]))],512),e("div",ct,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold mb-4 text-green-600"},"Contratos Asociados",-1)),e("div",vt,[(y(!0),b(ve,null,pe(w.value,o=>(y(),b("div",{key:o.id_contrato,onClick:V=>ne(o,"derecha"),class:"p-3 border border-gray-200 rounded-lg cursor-pointer hover:bg-success/10 hover:border-success/40 transition-colors"},[e("div",mt,[e("div",gt,[e("h4",ft,k(o.entidad?.nombre||"Sin entidad"),1),e("p",bt,"N° "+k(o.num_consecutivo),1),e("p",yt,k(o.tipoContrato?.nombre||"Sin tipo"),1),e("p",xt,k(n(o.fecha_inicio))+" - "+k(n(o.fecha_fin)),1)]),t[17]||(t[17]=e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 19l-7-7 7-7"})],-1))])],8,pt))),128))])])]),e("div",ht,[e("div",wt,[e("div",kt,[e("span",Ct,k(f.value.length),1),t[19]||(t[19]=R(" contratos disponibles | ",-1)),e("span",jt,k(w.value.length),1),t[20]||(t[20]=R(" contratos asociados ",-1))]),e("div",_t,[e("button",{onClick:t[5]||(t[5]=o=>u.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500"}," Cancelar "),e("button",{onClick:ie,class:"px-4 py-2 text-white bg-blue-500 rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500"}," Guardar Asociaciones ")])])])])])):P("",!0)}},St={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Et={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},At={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},$t={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},Vt={class:"bg-white rounded-lg shadow-md p-4"},zt={class:"grid grid-cols-1 md:grid-cols-3 gap-4 items-end mb-4 md:mb-2"},It={class:"relative"},Dt={class:"w-[95%] mx-auto px-4 py-4"},Lt={__name:"trabajadores",setup(m){const{navigateTo:K}=we(),j=i(""),B=i(""),d=i(""),I=i(""),_=i(""),f=i([{label:"Todos",value:""},{label:"Concidia",value:"Concidia"},{label:"Firma",value:"Firma"},{label:"Concidia y Firma",value:"Concidia y Firma"}]),w=i([]),D=i(0),M=i(10),A=i(1),p=i(!1),N=i(!1),F=i(!1),x=i(null),C=i([]),r=i(!1),n=i(!1),s=i(null),Z=i(!1),W=i(null),ne=[{key:"nombre",label:"Nombre"},{key:"cargo",label:"Cargo"},{key:"carnet_identidad",label:"Carnet"},{key:"funcion",label:"Función"},{key:"contratosAsociados",label:"Contratos Asociados"}],ie=[{name:"Editar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})])}},handler:l=>{x.value=l,r.value=!0,n.value=!1,N.value=!0},buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Asociar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})])}},handler:l=>{x.value=l,F.value=!0},buttonClass:"px-3 py-1 bg-primary text-neutral rounded-md hover:bg-primary/90"},{name:"Eliminar",icon:{render(){return te("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[te("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}},handler:l=>{W.value=l,Z.value=!0},buttonClass:"px-3 py-1 bg-danger text-neutral rounded-md hover:bg-danger/90"}],ee=async()=>{try{const l=localStorage.getItem("token"),a=U(),g=await(await fetch(`${a.public.backendHost}/entidad`,{method:"GET",headers:{Authorization:l,Accept:"application/json"}})).json();C.value=Array.isArray(g.data)?g.data:[]}catch{C.value=[]}},q=async(l=A.value,a=M.value)=>{p.value=!0;try{const c=localStorage.getItem("token"),g=U(),T={nombre:j.value,cargo:B.value,carnet_identidad:d.value,id_entidad:I.value,funcion:_.value},X=await(await fetch(`${g.public.backendHost}/trabajadorAutorizado/filter/${l}/${a}`,{method:"POST",headers:{Authorization:c,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)})).json();w.value=Array.isArray(X.data)?X.data.map(L=>({...L,contratosAsociados:Array.isArray(L.contratos)?L.contratos.length:0})):[],D.value=X.pagination?.total||0}catch{w.value=[],D.value=0}finally{p.value=!1}},re=l=>{A.value=l,q(l)},u=l=>{x.value=l,r.value=!1,n.value=!0,N.value=!0};fe(()=>{q(),ee()});const t=async l=>{try{const a=localStorage.getItem("token"),c=U(),g=r.value?`${c.public.backendHost}/trabajadorAutorizado/UpdateTrabajadorAutorizado/${x.value.id_trabajador_autorizado}`:`${c.public.backendHost}/trabajadorAutorizado/createTrabajadorAutorizado`,T=await fetch(g,{method:r.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:a,Accept:"application/json"},body:JSON.stringify(l)});if(T.status===401){s.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{K("/")},3e3);return}if(T.status===403){s.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(T.status===400||T.status===500){const H=await T.json();H.error?s.value={title:`Errores de validación: ${T.status}`,description:H.message,type:"error"}:s.value={title:`Error: ${T.status}`,description:JSON.stringify(H),type:"error"};return}T.ok?(r.value?s.value={title:`Trabajador Actualizado: ${T.status}`,description:`El trabajador ${l.nombre} se actualizó con éxito`,type:"success"}:s.value={title:`Trabajador Creado: ${T.status}`,description:`El trabajador ${l.nombre} se creó con éxito`,type:"success"},await q(A.value,M.value),N.value=!1,x.value=null,r.value=!1,n.value=!1):console.error("Error al guardar el trabajador")}catch(a){console.error("Error:",a),s.value={title:"Error",description:a.message,type:"error"}}},o=l=>{let a=l.target.value.replace(/\D/g,"");a.length>11&&(a=a.slice(0,11)),d.value=a},V=()=>{x.value=null,r.value=!1,n.value=!1,N.value=!0},E=l=>{console.log("Guardando asociaciones:",l),F.value=!1,q()};async function Q(){if(Z.value=!1,!!W.value)try{const l=localStorage.getItem("token"),a=U(),c=await fetch(`${a.public.backendHost}/trabajadorAutorizado/DeleteTrabajadorAutorizado/${W.value.id_trabajador_autorizado}`,{method:"DELETE",headers:{Authorization:l,Accept:"application/json"}});if(c.status===401){s.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{K("/")},3e3);return}if(c.status===403){s.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!c.ok){const g=await c.json();s.value={title:`Error al eliminar: ${c.status}`,description:g.message||JSON.stringify(g),type:"error"};return}s.value={title:"Trabajador eliminado",description:"El trabajador fue eliminado correctamente",type:"success"},await q(A.value,M.value)}catch(l){s.value={title:"Error",description:l.message,type:"error"}}finally{W.value=null}}const z=async()=>{try{p.value=!0,await q(1,M.value)}catch(l){console.error("Error al buscar trabajadores:",l)}finally{p.value=!1}};async function O(){s.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),a=U(),c={nombre:j.value,cargo:B.value,carnet_identidad:d.value,id_entidad:I.value,funcion:_.value},g=await fetch(`${a.public.backendHost}/trabajadorAutorizado/filter/1/${D.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(c)});if(g.status===401){s.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{K("/")},3e3);return}if(g.status===403){s.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!g.ok){const h=await g.json();s.value={title:"Error al consultar datos",description:h.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const H=(await g.json()).data.map(h=>({Nombre:h.nombre,Cargo:h.cargo,"Carnet de Identidad":h.carnet_identidad,Teléfono:h.num_telefono,Función:h.funcion,"Contratos Asociados":Array.isArray(h.contratos)?h.contratos.length:0})),X=oe.json_to_sheet(H),L=oe.book_new();oe.book_append_sheet(L,X,"Trabajadores");const le=new Date().toISOString().split("T")[0];ge(L,`trabajadores_${le}.xlsx`),s.value=null}catch(l){console.error("Error al exportar a Excel:",l),s.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function Y(){s.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),a=U(),c={nombre:j.value,cargo:B.value,carnet_identidad:d.value,id_entidad:I.value,funcion:_.value},g=await fetch(`${a.public.backendHost}/trabajadorAutorizado/filter/1/${D.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(c)});if(g.status===401){s.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{K("/")},3e3);return}if(g.status===403){s.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!g.ok){const h=await g.json();s.value={title:"Error al consultar datos",description:h.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const T=await g.json(),H=[];T.data.forEach(h=>{Array.isArray(h.contratos)&&h.contratos.forEach(v=>{H.push({"Nombre Trabajador":h.nombre,"Cargo Trabajador":h.cargo,"Función Trabajador":h.funcion,"Carnet Identidad":h.carnet_identidad,"Teléfono Trabajador":h.num_telefono,"ID Contrato":v.id_contrato,"Número Consecutivo":v.num_consecutivo,"Fecha Inicio":v.fecha_inicio?new Date(v.fecha_inicio).toLocaleDateString("es-ES"):"","Fecha Fin":v.fecha_fin?new Date(v.fecha_fin).toLocaleDateString("es-ES"):"",Clasificación:v.clasificacion,Nota:v.nota,"Cliente/Proveedor":v.ClienteOProveedor,"Vigencia Facturas (Días)":v.vigenciaFacturasDias,"Tipo Contrato":v.tipoContrato?v.tipoContrato.nombre:"",Entidad:v.entidad?v.entidad.nombre:"","Dirección Entidad":v.entidad?v.entidad.direccion:"","Teléfono Entidad":v.entidad?v.entidad.telefono:"","Email Entidad":v.entidad?v.entidad.email:"",Organismo:v.entidad?v.entidad.organismo:"","Tipo Entidad":v.entidad?v.entidad.tipo_entidad:"","Código REO":v.entidad?v.entidad.codigo_reo:"","Código NIT":v.entidad?v.entidad.codigo_nit:""})})});const X=oe.json_to_sheet(H),L=oe.book_new();oe.book_append_sheet(L,X,"Trabajadores con Contratos");const le=new Date().toISOString().split("T")[0];ge(L,`trabajadores_contratos_${le}.xlsx`),s.value=null}catch(l){console.error("Error al exportar a Excel con contratos:",l),s.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}return(l,a)=>(y(),b("div",St,[S(ke,{title:"Trabajadores - Contract Manager",description:"Registra y gestiona trabajadores autorizados y sus contratos.",canonical:"/trabajadores"}),S(Ce),s.value?(y(),b("div",Et,[S(ce,{title:s.value.title,description:s.value.description,type:s.value.type,onClose:a[0]||(a[0]=c=>s.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):P("",!0),Z.value?(y(),b("div",At,[S(je,{title:"¿Estás seguro que deseas eliminar este trabajador?",description:"Esta acción no se puede deshacer.",type:"warning",onConfirm:Q,onClose:a[1]||(a[1]=c=>Z.value=!1)})])):P("",!0),e("div",$t,[e("div",Vt,[e("div",zt,[e("div",null,[a[10]||(a[10]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por nombre",-1)),e("div",It,[J(e("input",{type:"text","onUpdate:modelValue":a[2]||(a[2]=c=>j.value=c),placeholder:"Ingrese el nombre...",class:"w-full pl-10 pr-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(z,["enter"])},null,544),[[G,j.value]]),a[9]||(a[9]=e("div",{class:"absolute left-3 top-2.5"},[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})])],-1))])]),e("div",null,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Buscar por cargo",-1)),J(e("input",{type:"text","onUpdate:modelValue":a[3]||(a[3]=c=>B.value=c),placeholder:"Ingrese el cargo...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:de(z,["enter"])},null,544),[[G,B.value]])]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carnet de Identidad",-1)),J(e("input",{type:"text","onUpdate:modelValue":a[4]||(a[4]=c=>d.value=c),placeholder:"Carnet de identidad...",maxlength:"11",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",onInput:o,onKeyup:de(z,["enter"])},null,544),[[G,d.value]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),S(ae,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=c=>I.value=c),options:C.value,labelKey:"nombre",valueKey:"id_entidad",placeholder:"Buscar entidad..."},null,8,["modelValue","options"])]),e("div",null,[a[14]||(a[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Función",-1)),S(ae,{modelValue:_.value,"onUpdate:modelValue":a[6]||(a[6]=c=>_.value=c),options:f.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar función..."},null,8,["modelValue","options"])])]),e("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[e("button",{onClick:z,class:"px-6 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:O,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[15]||(a[15]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),R(" Exportar a Excel ",-1)])]),e("button",{onClick:Y,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...a[16]||(a[16]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),R(" Exportar a Excel con Contratos ",-1)])])])])]),e("div",Dt,[e("div",{class:"flex justify-between items-center mb-4"},[a[18]||(a[18]=e("h2",{class:"text-2xl font-bold"},"Trabajadores Autorizados",-1)),e("button",{onClick:V,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center"},[...a[17]||(a[17]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),R(" Nuevo Trabajador ",-1)])])]),S(be,{columns:ne,items:w.value,actions:ie,"total-items":D.value,"items-per-page":M.value,"current-page":A.value,"is-loading":p.value,onPageChange:re,onRowClick:u},null,8,["items","total-items","items-per-page","current-page","is-loading"])]),S(Ke,{modelValue:N.value,"onUpdate:modelValue":a[7]||(a[7]=c=>N.value=c),trabajador:x.value,"is-editing":r.value,"is-viewing":n.value,onSubmit:t},null,8,["modelValue","trabajador","is-editing","is-viewing"]),S(Tt,{modelValue:F.value,"onUpdate:modelValue":a[8]||(a[8]=c=>F.value=c),trabajador:x.value,entidades:C.value,onSaveAssociations:E},null,8,["modelValue","trabajador","entidades"])]))}};export{Lt as default};
