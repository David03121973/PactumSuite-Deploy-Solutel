const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./CyMFbyVm.js","./CHBhapNt.js","./entry.9UJSYqx2.css"])))=>i.map(i=>d[i]);
import{r as g,L as pe,k as U,q as D,n as he,y as x,F as B,z as w,A as e,C as M,B as m,H as $e,K as le,I as P,J as j,M as ve,N as fe,E as k,_ as je,o as Ee,R as Fe,S as we,h as me}from"#entry";import{_ as Se,N as Te}from"./B2AczXHm.js";import{S as Ie}from"./CC2Sf2Ne.js";import{D as De}from"./Dx2RwFw2.js";import{_ as Me}from"./0uQ-aPjh.js";import{_ as ke}from"./BeGU4USo.js";import{_ as be}from"./rxRbyMz-.js";import{u as te,w as Ce}from"./3SA47z_C.js";const Ne={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center"},ze={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Ae={class:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[80vh] overflow-y-auto"},Ue={class:"flex justify-between items-center mb-6"},Be={class:"text-2xl font-bold text-gray-800"},Oe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Le={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},He={key:0},Re={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Ke=["readonly","disabled"],qe=["readonly","disabled"],Ge={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4"},Je=["readonly","disabled"],We=["readonly","disabled"],Ye={class:"mt-4"},Ze={class:"relative flex w-full"},Qe=["disabled"],Xe=["disabled"],et={key:0,class:"mt-4"},tt=["onUpdate:modelValue"],ot=["onUpdate:modelValue","onBlur","disabled"],at=["onUpdate:modelValue","onBlur","readonly","disabled"],rt=["value"],nt=["onClick","disabled"],it=["disabled"],lt={class:"mt-4 p-4 bg-gray-100 rounded-lg"},st={key:1,class:"mt-4"},dt=["onUpdate:modelValue","disabled"],ut=["onUpdate:modelValue","disabled"],ct=["onUpdate:modelValue","onBlur","disabled"],_t=["onUpdate:modelValue","onBlur","disabled"],mt=["value"],pt=["onClick","disabled"],vt=["disabled"],bt={class:"mt-4 p-4 bg-gray-100 rounded-lg"},gt={key:2,class:"flex justify-end space-x-4 mt-6"},ft=["disabled"],yt=["disabled"],xt={key:0,class:"flex items-center"},wt={key:1},ht={key:0,class:"text-red-600 text-sm mt-2"},kt={__name:"FacturaModal",props:{modelValue:{type:Boolean,required:!0},factura:{type:Object,default:()=>({})},isEditing:{type:Boolean,default:!1},isViewing:{type:Boolean,default:!1},contratos:{type:Array,default:()=>[]},entidades:{type:Array,default:()=>[]},trabajadores:{type:Array,default:()=>[]},usuarios:{type:Array,default:()=>[]}},emits:["update:modelValue","submit"],setup(c,{emit:Y}){const s=c,Z=Y,u=g({id_entidad:"",id_contrato:"",id_usuario:"",id_trabajador_autorizado:"",num_consecutivo:"",fecha:"",estado:"",nota:"",cargoAdicional:""}),p=g("productos");pe(()=>s.factura,a=>{a&&a.tipoFactura?p.value=a.tipoFactura:p.value="productos"});function S(a){s.isViewing||s.isLoading||(p.value=a,u.value.tipoFactura=a)}const H=g([{label:"Facturado",value:"Facturado"},{label:"No Facturado",value:"No Facturado"},{label:"Cancelado",value:"Cancelado"}]),$=g([{descripcion:"",unidadMedida:"",cantidad:0,importe:0}]),C=g([{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}]),N=g(""),h=g(!1),T=g(null),O=g([]),se=g(null),y=g(null),Q=g(null),K=U(()=>O.value.find(a=>a.id_contrato===u.value.id_contrato)),q=U(()=>K.value?K.value.ClienteOProveedor!=="Cliente":!1);async function de(){const a=localStorage.getItem("token");if(!a){D("/");return}try{const o=he(),n=new Date().getFullYear(),f=await fetch(`${o.public.backendHost}/Factura/nextConsecutivo/${n}`,{method:"GET",headers:{Authorization:a}});if(f.status===401||f.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(f.ok){const v=await f.json();v.data&&v.data.nextConsecutivo&&(u.value.num_consecutivo=v.data.nextConsecutivo,localStorage.setItem("num_consecutivo_guardado",v.data.nextConsecutivo))}else console.error("Error al obtener el siguiente consecutivo")}catch(o){console.error("Error al obtener el siguiente consecutivo:",o)}}pe(()=>s.modelValue,async a=>{a&&(!s.isEditing&&!s.isViewing?await de():s.isViewing&&await de())}),pe(()=>s.factura,async a=>{if(a&&Object.keys(a).length>0){if(u.value={id_entidad:a.contrato?.id_entidad||"",id_contrato:a.id_contrato||"",id_usuario:a.id_usuario||"",id_trabajador_autorizado:a.id_trabajador_autorizado||"",num_consecutivo:a.num_consecutivo||"",fecha:a.fecha?a.fecha.substring(0,10):"",estado:a.estado||"",nota:a.nota||"",cargoAdicional:a.cargoAdicional||""},a.servicio&&a.servicio.length>0?(p.value="servicios",$.value=[...a.servicio],u.value.services=[...a.servicio],C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],u.value.products=[]):(p.value="productos",a.productos&&a.productos.length>0?(C.value=a.productos.map(o=>({id_producto:o.id_producto,nombre:o.nombre,unidadMedida:o.unidadMedida,cantidad:o.factura_producto?.cantidad||0,precio:o.factura_producto?.precioVenta||o.precio})),u.value.products=[...a.productos]):(C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],u.value.products=[]),$.value=[{descripcion:"",unidadMedida:"",cantidad:0,importe:0}],u.value.services=[]),a.contrato?.id_entidad&&await ue(a.contrato.id_entidad),(s.isViewing||s.isEditing)&&(a.id_usuario&&await I(a.id_usuario),a.id_trabajador_autorizado&&await i(a.id_trabajador_autorizado)),!s.isViewing){const o=O.value.find(n=>n.id_contrato===u.value.id_contrato);if(o&&o.ClienteOProveedor==="Cliente"){const n=localStorage.getItem("num_consecutivo_guardado");n&&(u.value.num_consecutivo=n,console.log("Carga inicial (crear/editar): Número consecutivo establecido a:",n))}}}else u.value={id_entidad:"",id_contrato:"",id_usuario:"",id_trabajador_autorizado:"",num_consecutivo:"",fecha:"",estado:"",nota:"",cargoAdicional:""},O.value=[],se.value=null,y.value=null,Q.value=null,C.value=[{id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}],$.value=[{descripcion:"",unidadMedida:"",cantidad:0,importe:0}]},{immediate:!0}),pe(()=>u.value.id_contrato,a=>{if(!s.isViewing&&a){const o=O.value.find(n=>n.id_contrato===a);if(o&&o.ClienteOProveedor==="Cliente"){const n=localStorage.getItem("num_consecutivo_guardado");n&&(u.value.num_consecutivo=n,console.log("Selección de contrato (crear/editar): Número consecutivo establecido a:",n))}}}),pe(()=>C.value,a=>{if(a.length>0&&!s.isViewing){const o=a[a.length-1];o.id_producto&&o.unidadMedida&&o.cantidad>0&&o.precio>0&&C.value.push({id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0})}},{deep:!0}),pe(()=>$.value,a=>{if(a.length>0&&!s.isViewing){const o=a[a.length-1];o.descripcion&&o.unidadMedida&&o.cantidad>0&&o.importe>0&&$.value.push({descripcion:"",unidadMedida:"",cantidad:0,importe:0})}},{deep:!0});const ye=async()=>{if(N.value="",p.value==="productos"?(u.value.products=C.value.filter(a=>a.id_producto&&a.cantidad>0),delete u.value.services):(u.value.services=$.value.filter(a=>a.descripcion&&a.unidadMedida&&a.cantidad>0&&a.importe>0),delete u.value.products),!s.isEditing&&!s.isViewing){const a=localStorage.getItem("usuario");if(a)try{const o=JSON.parse(a);o&&o.id_usuario&&(u.value.id_usuario=o.id_usuario)}catch(o){console.error("Error al parsear datos de usuario del localStorage:",o)}}if(!u.value.id_contrato){N.value="Debe seleccionar un Contrato.";return}if(!u.value.id_usuario){N.value="Debe seleccionar un Usuario.";return}if(!u.value.num_consecutivo){N.value="Debe ingresar el Número Consecutivo.";return}if(!u.value.fecha){N.value="Debe ingresar la Fecha.";return}if(!u.value.estado){N.value="Debe seleccionar un Estado.";return}h.value=!0,T.value={title:s.isEditing?"Guardando Factura":"Creando Factura",description:"Comunicando con el servidor, espere por favor...",type:"warning"};try{Z("submit",{...u.value})}catch(a){console.error("Error en handleSubmit:",a)}finally{setTimeout(()=>{h.value=!1,T.value=null},500)}},J=U(()=>s.factura&&s.factura.contrato&&s.factura.contrato.entidad&&s.factura.contrato.entidad.nombre||""),ee=U(()=>y.value?y.value.nombre||"":s.factura&&s.factura.usuario&&s.factura.usuario.nombre||""),z=U(()=>Q.value?Q.value.nombre||"":s.factura&&s.factura.trabajador_autorizado&&s.factura.trabajador_autorizado.nombre||""),ge=async a=>{a&&a.id_entidad?(u.value.id_contrato="",await ue(a.id_entidad)):(O.value=[],u.value.id_contrato="")};async function ue(a){if(!a){O.value=[];return}const o=localStorage.getItem("token");if(!o){D("/");return}T.value={title:"Cargando Datos de la Base de Datos",description:"Obteniendo contratos de la base de datos...",type:"info"};try{const n=he(),f=await fetch(`${n.public.backendHost}/entidad/${a}`,{method:"GET",headers:{Authorization:o}});if(f.status===401||f.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(f.ok){const v=await f.json();se.value=v;const G=v?.contratos||[];O.value=G.map(ne=>({...ne,displayLabel:`${ne.num_consecutivo} - ${ne.tipoContrato?.nombre||""} - ${ne.ClienteOProveedor||""}`}))}else console.error("Error en la respuesta:",f.status),O.value=[]}catch(n){console.error("Error al cargar contratos:",n),O.value=[]}finally{setTimeout(()=>{T.value=null},3e3)}}async function I(a){if(!a)return;const o=localStorage.getItem("token");if(!o){D("/");return}try{const n=he(),f=await fetch(`${n.public.backendHost}/Usuario/${a}`,{method:"GET",headers:{Authorization:o}});if(f.status===401||f.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(f.ok){const v=await f.json();y.value={nombre:v.nombre}}else console.error("Error al cargar usuario:",f.status)}catch(n){console.error("Error al cargar usuario:",n)}}async function i(a){if(!a)return;const o=localStorage.getItem("token");if(!o){D("/");return}try{const n=he(),f=await fetch(`${n.public.backendHost}/trabajadorAutorizado/${a}`,{method:"GET",headers:{Authorization:o}});if(f.status===401||f.status===403){errorBanner.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(f.ok){const v=await f.json();Q.value={nombre:v.nombre}}else console.error("Error al cargar trabajador:",f.status)}catch(n){console.error("Error al cargar trabajador:",n)}}function t(){$.value.push({descripcion:"",unidadMedida:"",cantidad:0,importe:0})}function _(a){$.value.length>1&&$.value.splice(a,1)}function V(){C.value.push({id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0})}function oe(a,o){if(o>=0&&o<C.value.length)if(a){let n=0,f=a.precio||0;if(s.factura&&s.factura.id_factura&&a.facturaProductos){const v=a.facturaProductos.find(G=>G.id_factura===s.factura.id_factura);v&&(n=Number(v.cantidad)||0,f=Number(v.precioVenta)||a.precio||0)}C.value[o]={...C.value[o],id_producto:a.id_producto,nombre:a.nombre,unidadMedida:a.unidadMedida||"",cantidad:n,precio:f}}else C.value[o]={...C.value[o],id_producto:"",nombre:"",unidadMedida:"",cantidad:0,precio:0}}function L(a){C.value.length>1&&C.value.splice(a,1)}const ce=a=>{a.cantidad!==void 0&&a.cantidad!==null&&(a.cantidad=Number(a.cantidad).toFixed(2))},ae=a=>{a.precio!==void 0&&a.precio!==null&&(a.precio=Number(a.precio).toFixed(2))},W=a=>{a.importe!==void 0&&a.importe!==null&&(a.importe=Number(a.importe).toFixed(2))};function _e(a){const o=Number(a.cantidad)||0,n=Number(a.precio)||0,f=Number(a.importe)||0,v=a.precio!==void 0?n:f;return(o*v).toFixed(2)}const X=U(()=>(C.value.reduce((o,n)=>o+Number(n.cantidad)*Number(n.precio),0)+(Number(u.value.cargoAdicional)||0)).toFixed(2)),re=U(()=>($.value.reduce((o,n)=>o+Number(n.cantidad)*Number(n.importe),0)+(Number(u.value.cargoAdicional)||0)).toFixed(2));return(a,o)=>c.modelValue?(w(),x("div",Ne,[T.value?(w(),x("div",ze,[M(Se,{title:T.value.title,description:T.value.description,type:T.value.type,onClose:o[0]||(o[0]=n=>T.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):B("",!0),e("div",Ae,[e("div",Ue,[e("h2",Be,m(c.isViewing?"Detalles de Factura":c.isEditing?"Editar Factura":"Nueva Factura"),1),e("button",{onClick:o[1]||(o[1]=n=>a.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...o[14]||(o[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$e(ye,["prevent"]),class:"space-y-4"},[e("div",Oe,[e("div",null,[o[15]||(o[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad",-1)),M(be,{modelValue:u.value.id_entidad,"onUpdate:modelValue":o[2]||(o[2]=n=>u.value.id_entidad=n),endpoint:"/entidad/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_entidad",placeholder:"Buscar entidad por nombre...",disabled:c.isViewing||h.value,"initial-label":J.value,onEntidadSeleccionada:ge},null,8,["modelValue","disabled","initial-label"])]),e("div",null,[o[16]||(o[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato",-1)),M(ke,{modelValue:u.value.id_contrato,"onUpdate:modelValue":o[3]||(o[3]=n=>u.value.id_contrato=n),options:O.value,labelKey:"displayLabel",valueKey:"id_contrato",disabled:c.isViewing||h.value||!u.value.id_entidad,class:le({"opacity-50":!u.value.id_entidad}),placeholder:"Seleccione primero una entidad..."},null,8,["modelValue","options","disabled","class"])])]),e("div",Le,[c.isViewing||c.isEditing?(w(),x("div",He,[o[17]||(o[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario",-1)),M(be,{modelValue:u.value.id_usuario,"onUpdate:modelValue":o[4]||(o[4]=n=>u.value.id_usuario=n),endpoint:"/Usuario/filterUsers",method:"POST","search-key":"nombre_usuario","label-key":"nombre_usuario","value-key":"id_usuario",placeholder:"Buscar usuario por nombre...",disabled:!0,"initial-label":ee.value,"direct-data":!0,class:le({"opacity-50":c.isViewing||c.isEditing})},null,8,["modelValue","initial-label","class"])])):B("",!0),e("div",null,[o[18]||(o[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trabajador Autorizado",-1)),M(be,{modelValue:u.value.id_trabajador_autorizado,"onUpdate:modelValue":o[5]||(o[5]=n=>u.value.id_trabajador_autorizado=n),endpoint:"/trabajadorAutorizado/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_trabajador",placeholder:"Buscar trabajador por nombre...",disabled:c.isViewing||h.value,"initial-label":z.value},null,8,["modelValue","disabled","initial-label"])])]),e("div",Re,[e("div",null,[o[19]||(o[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Número Consecutivo",-1)),P(e("input",{"onUpdate:modelValue":o[6]||(o[6]=n=>u.value.num_consecutivo=n),type:"number",readonly:c.isViewing||!q.value,disabled:h.value,class:le(["w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",{"bg-gray-100 text-gray-500":c.isViewing||!q.value}]),required:""},null,10,Ke),[[j,u.value.num_consecutivo]])]),e("div",null,[o[20]||(o[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha",-1)),P(e("input",{"onUpdate:modelValue":o[7]||(o[7]=n=>u.value.fecha=n),type:"date",readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",required:""},null,8,qe),[[j,u.value.fecha]])])]),e("div",Ge,[e("div",null,[o[21]||(o[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),M(ke,{modelValue:u.value.estado,"onUpdate:modelValue":o[8]||(o[8]=n=>u.value.estado=n),options:H.value,labelKey:"label",valueKey:"value",disabled:c.isViewing||h.value,placeholder:"Selecciona un estado"},null,8,["modelValue","options","disabled"])]),e("div",null,[o[22]||(o[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cargo Adicional",-1)),P(e("input",{"onUpdate:modelValue":o[9]||(o[9]=n=>u.value.cargoAdicional=n),type:"number",readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese cargo adicional (opcional)"},null,8,Je),[[j,u.value.cargoAdicional]])])]),e("div",null,[o[23]||(o[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nota",-1)),P(e("textarea",{"onUpdate:modelValue":o[10]||(o[10]=n=>u.value.nota=n),readonly:c.isViewing,disabled:c.isViewing||h.value,class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500",rows:"2",placeholder:"Ingrese una nota opcional"},null,8,We),[[j,u.value.nota]])]),e("div",Ye,[o[24]||(o[24]=e("label",{class:"block text-sm font-medium text-gray-700 mb-2 text-center"},"Tipo de Factura",-1)),e("div",Ze,[e("div",{class:le(["absolute top-0 left-0 w-1/2 h-full bg-primary rounded-lg transition-transform duration-300",p.value==="productos"?"transform translate-x-0":"transform translate-x-full"])},null,2),e("button",{type:"button",onClick:o[11]||(o[11]=n=>S("productos")),class:le(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",p.value==="productos"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:c.isViewing||h.value}," Venta Productos ",10,Qe),e("button",{type:"button",onClick:o[12]||(o[12]=n=>S("servicios")),class:le(["relative flex-1 px-4 py-2 rounded-lg font-medium transition-all duration-300 z-10",p.value==="servicios"?"text-neutral bg-transparent":"text-dark bg-secondary"]),disabled:c.isViewing||h.value}," Prestación de Servicios ",10,Xe)])]),p.value==="productos"?(w(),x("div",et,[o[27]||(o[27]=e("h3",{class:"text-lg font-semibold mb-2"},"Productos",-1)),o[28]||(o[28]=e("div",{class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2 font-semibold text-gray-700"},[e("span",{class:"col-span-2"},"Producto"),e("span",null,"Uni/Medida"),e("span",null,"Cantidad"),e("span",null,"Precio"),e("span",null,"Total"),e("span",null,"Acción")],-1)),(w(!0),x(ve,null,fe(C.value,(n,f)=>(w(),x("div",{key:f,class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2"},[M(be,{modelValue:n.id_producto,"onUpdate:modelValue":v=>n.id_producto=v,endpoint:"/producto/filterProductos/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_producto",placeholder:"Buscar producto por nombre...",disabled:c.isViewing||h.value,"initial-label":n.nombre||"",onProductoSeleccionado:v=>oe(v,f),class:"col-span-2"},null,8,["modelValue","onUpdate:modelValue","disabled","initial-label","onProductoSeleccionado"]),P(e("input",{"onUpdate:modelValue":v=>n.unidadMedida=v,type:"text",placeholder:"Uni/Medida",readonly:"",class:"px-4 py-2 border-2 border-gray-400 rounded-lg opacity-50"},null,8,tt),[[j,n.unidadMedida]]),P(e("input",{"onUpdate:modelValue":v=>n.cantidad=v,onBlur:v=>ce(n),type:"number",step:"0.01",placeholder:"Cantidad",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,ot),[[j,n.cantidad,void 0,{number:!0}]]),P(e("input",{"onUpdate:modelValue":v=>n.precio=v,onBlur:v=>ae(n),type:"number",step:"0.01",placeholder:"Precio",readonly:!c.isEditing||c.isViewing,disabled:c.isViewing||h.value,class:le(["px-4 py-2 border-2 border-gray-400 rounded-lg",{"opacity-50":!c.isEditing||c.isViewing}])},null,42,at),[[j,n.precio,void 0,{number:!0}]]),e("input",{value:_e(n),type:"text",readonly:"",class:"px-4 py-2 border-2 border-blue-400 bg-blue-50 rounded-lg font-bold text-blue-800"},null,8,rt),e("button",{onClick:v=>L(f),type:"button",class:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center",disabled:c.isViewing||h.value},[...o[25]||(o[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),k(" Eliminar ",-1)])],8,nt)]))),128)),e("button",{onClick:V,type:"button",class:"px-4 py-2 bg-purple-500 text-white rounded-lg mt-2 flex items-center",disabled:c.isViewing||h.value},[...o[26]||(o[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),k(" Producto ",-1)])],8,it),e("div",lt,[e("strong",null,"Importe Total Productos: "+m(X.value),1)])])):B("",!0),p.value==="servicios"?(w(),x("div",st,[o[31]||(o[31]=e("h3",{class:"text-lg font-semibold mb-2"},"Servicios",-1)),o[32]||(o[32]=e("div",{class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2 font-semibold text-gray-700"},[e("span",{class:"col-span-2"},"Descripción"),e("span",null,"Uni/Medida"),e("span",null,"Cantidad"),e("span",null,"Importe"),e("span",null,"Total"),e("span",null,"Acción")],-1)),(w(!0),x(ve,null,fe($.value,(n,f)=>(w(),x("div",{key:n.id_servicio,class:"grid grid-cols-1 md:grid-cols-7 gap-4 mb-2"},[P(e("input",{"onUpdate:modelValue":v=>n.descripcion=v,type:"text",placeholder:"Descripción",class:"col-span-2 px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,8,dt),[[j,n.descripcion]]),P(e("input",{"onUpdate:modelValue":v=>n.unidadMedida=v,type:"text",placeholder:"Uni/Medida",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,8,ut),[[j,n.unidadMedida]]),P(e("input",{"onUpdate:modelValue":v=>n.cantidad=v,onBlur:v=>ce(n),type:"number",step:"0.01",placeholder:"Cantidad",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,ct),[[j,n.cantidad,void 0,{number:!0}]]),P(e("input",{"onUpdate:modelValue":v=>n.importe=v,onBlur:v=>W(n),type:"number",step:"0.01",placeholder:"Importe",class:"px-4 py-2 border-2 border-gray-400 rounded-lg",disabled:c.isViewing||h.value},null,40,_t),[[j,n.importe,void 0,{number:!0}]]),e("input",{value:_e(n),type:"text",readonly:"",class:"px-4 py-2 border-2 border-blue-400 bg-blue-50 rounded-lg font-bold text-blue-800"},null,8,mt),e("button",{onClick:v=>_(f),type:"button",class:"px-4 py-2 bg-red-500 text-white rounded-lg flex items-center",disabled:c.isViewing||h.value},[...o[29]||(o[29]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1),k(" Eliminar ",-1)])],8,pt)]))),128)),e("button",{onClick:t,type:"button",class:"px-4 py-2 bg-purple-500 text-white rounded-lg mt-2 flex items-center",disabled:c.isViewing||h.value},[...o[30]||(o[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})],-1),k(" Servicio ",-1)])],8,vt),e("div",bt,[e("strong",null,"Importe Total Servicios: "+m(re.value),1)])])):B("",!0),c.isViewing?B("",!0):(w(),x("div",gt,[e("button",{type:"button",onClick:o[13]||(o[13]=n=>a.$emit("update:modelValue",!1)),class:"px-4 py-2 text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500",disabled:h.value}," Cancelar ",8,ft),e("button",{type:"submit",class:"px-4 py-2 text-neutral bg-primary rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:h.value},[h.value?(w(),x("span",xt,[o[33]||(o[33]=e("svg",{class:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)),k(" "+m(c.isEditing?"Guardando...":"Creando..."),1)])):(w(),x("span",wt,m(c.isEditing?"Guardar Cambios":"Crear Factura"),1))],8,yt)]))],32),N.value?(w(),x("div",ht,m(N.value),1)):B("",!0)])])):B("",!0)}},Ct={key:0,class:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"},Ft={class:"bg-white rounded-lg p-2 w-full max-w-5xl max-h-[95vh] overflow-y-auto shadow-2xl"},Vt={class:"flex justify-between items-center mb-6"},$t={class:"flex space-x-2"},Et=["disabled"],St=["disabled"],Pt={key:0,class:"mb-6 p-4 bg-red-100 border border-red-400 text-red-700 rounded-lg"},jt={class:"mt-2 list-disc list-inside"},Tt={id:"factura-content",class:"bg-white p-6 max-w-full mx-auto",style:{"font-family":"Arial, sans-serif","font-size":"14px","line-height":"1.4"}},It={class:"text-center mb-4"},Dt={class:"text-xl font-bold mb-3",style:{"font-size":"24px"}},Mt={class:"flex justify-end mb-4"},Nt={class:"text-right"},zt={class:"mb-1 text-lg"},At={class:"grid grid-cols-2 gap-10 mb-4"},Ut={class:"space-y-0.5"},Bt={class:"flex items-center justify-between"},Ot={class:"flex items-center justify-between"},Lt={class:"flex items-center justify-between"},Ht={class:"flex items-center justify-between"},Rt={class:"flex items-center justify-between"},Kt={class:"flex items-center justify-between"},qt={class:"flex items-center justify-between"},Gt={class:"space-y-0.5"},Jt={class:"flex items-center justify-between"},Wt={class:"flex items-center justify-between"},Yt={class:"flex items-center justify-between"},Zt={class:"flex items-center justify-between"},Qt={class:"w-full border-collapse border border-black mb-4"},Xt={class:"border border-black p-2"},eo={class:"border border-black p-2"},to={class:"border border-black p-2 text-right"},oo={class:"border border-black p-2 text-right"},ao={class:"border border-black p-2 text-right"},ro={class:"border border-black p-2"},no={class:"border border-black p-2"},io={class:"border border-black p-2 text-right"},lo={class:"border border-black p-2 text-right"},so={class:"border border-black p-2 text-right"},uo={class:"text-right mb-4"},co={class:"text-lg font-bold"},_o={class:"grid grid-cols-2 gap-10 mt-6"},mo={class:"space-y-0.5"},po={class:"space-y-0.5"},vo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 z-70 flex items-center justify-center p-4"},bo={class:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto shadow-2xl"},go={key:0,class:"text-red-500 text-xs mt-1"},fo={key:0,class:"text-red-500 text-xs mt-1"},yo={key:0,class:"text-red-500 text-xs mt-1"},Ve="factura_vendor_data",xo=10,wo={__name:"FacturaPDFModal",props:{modelValue:{type:Boolean,required:!0},factura:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(c,{emit:Y}){const s=c,Z=Y,u=g(!1),p=g({nombre:"",carnet_identidad:"",identificacion_fiscal:"",cuenta_bancaria:"",agencia_bancaria:"",direccion_particular:"",telefono:""}),S=g({carnet_identidad:"",cuenta_bancaria:"",telefono:""}),H=i=>i?/^\d+$/.test(i)?i.length>12?"El carné de identidad no puede tener más de 12 caracteres.":"":"El carné de identidad solo puede contener números.":"",$=i=>{if(!i)return"";const t=i.replace(/-/g,"");return t.length!==16||!/^\d+$/.test(t)?"La cuenta bancaria debe tener exactamente 16 dígitos.":""},C=i=>i?/^[\d-]+$/.test(i)?"":"El teléfono solo puede contener números y guiones.":"",N=i=>{let t=i.target.value;t=t.replace(/\D/g,"").substring(0,11),p.value.carnet_identidad=t,S.value.carnet_identidad=H(t)},h=i=>{let t=i.target.value;const _=t.replace(/[^0-9-]/g,""),V=_.replace(/-/g,"");V.length>16?t=V.substring(0,16).replace(/(\d{4})(?=\d)/g,"$1-"):t=_.replace(/(\d{4})(?=\d)/g,"$1-"),p.value.cuenta_bancaria=t,S.value.cuenta_bancaria=$(t)},T=i=>{let t=i.target.value;t=t.replace(/[^0-9-]/g,""),p.value.telefono=t,S.value.telefono=C(t)},O=()=>{try{const i=localStorage.getItem(Ve);i&&(p.value={...p.value,...JSON.parse(i)})}catch(i){console.error("Error cargando datos del vendedor:",i)}},se=()=>{if(S.value.carnet_identidad=H(p.value.carnet_identidad),S.value.cuenta_bancaria=$(p.value.cuenta_bancaria),S.value.telefono=C(p.value.telefono),!Object.values(S.value).some(t=>t!==""))try{localStorage.setItem(Ve,JSON.stringify(p.value)),K()}catch(t){console.error("Error guardando datos del vendedor:",t)}},y=i=>{const t=p.value[i];return t&&t.trim()!==""?t:"_________________"},Q=()=>{Z("update:modelValue",!1),u.value=!0},K=()=>{u.value=!1};Ee(()=>{O()});const q=U(()=>["nombre","carnet_identidad","identificacion_fiscal","cuenta_bancaria","agencia_bancaria","direccion_particular","telefono"].every(t=>{const _=p.value[t];return _&&_.trim()!==""})),de=U(()=>["nombre","carnet_identidad","identificacion_fiscal","cuenta_bancaria","agencia_bancaria","direccion_particular","telefono"].filter(t=>{const _=p.value[t];return!_||_.trim()===""})),ye=i=>({nombre:"Nombre Completo",carnet_identidad:"Carné de Identidad",identificacion_fiscal:"Identificación Fiscal (RC-05)",cuenta_bancaria:"Cuenta Bancaria",agencia_bancaria:"Agencia Bancaria",direccion_particular:"Dirección Particular",telefono:"Teléfono"})[i]||i,J=U(()=>s.factura.contrato?.ClienteOProveedor==="Proveedor");U(()=>J.value?{title:"Comprador",nombre:s.factura.contrato?.entidad?.nombre||"_________________",codigo:s.factura.contrato?.entidad?.consecutivo||"_________________",direccion:s.factura.contrato?.entidad?.direccion||"_________________",cuenta_bancaria:s.factura.contrato?.entidad?.cuenta_bancaria||"_________________",showConfigButton:!1}:{title:"Vendedor",nombre:y("nombre"),carnet_identidad:y("carnet_identidad"),identificacion_fiscal:y("identificacion_fiscal"),cuenta_bancaria:y("cuenta_bancaria"),agencia_bancaria:y("agencia_bancaria"),direccion_particular:y("direccion_particular"),telefono:y("telefono"),showConfigButton:!0}),U(()=>J.value?{title:"Vendedor",nombre:y("nombre"),carnet_identidad:y("carnet_identidad"),identificacion_fiscal:y("identificacion_fiscal"),cuenta_bancaria:y("cuenta_bancaria"),agencia_bancaria:y("agencia_bancaria"),direccion_particular:y("direccion_particular"),telefono:y("telefono"),showConfigButton:!0}:{title:"Comprador",nombre:s.factura.contrato?.entidad?.nombre||"_________________",codigo:s.factura.contrato?.entidad?.consecutivo||"_________________",direccion:s.factura.contrato?.entidad?.direccion||"_________________",cuenta_bancaria:s.factura.contrato?.entidad?.cuenta_bancaria||"_________________",showConfigButton:!1}),U(()=>J.value?{title:"Recibido",nombre:z()?.nombre||"________________________",cargo:z()?.cargo||"________________________",carnet_identidad:z()?.carnet_identidad||"________________________",fecha:"________________________"}:{title:"Emitido",nombre:s.factura.usuario?.nombre||"_________________",cargo:s.factura.usuario?.cargo||"_________________",carnet_identidad:s.factura.usuario?.carnet_identidad||"_________________",fecha:"___________"}),U(()=>J.value?{title:"Emitido",nombre:s.factura.usuario?.nombre||"_________________",cargo:s.factura.usuario?.cargo||"_________________",carnet_identidad:s.factura.usuario?.carnet_identidad||"_________________",fecha:"___________"}:{title:"Recibido",nombre:z()?.nombre||"________________________",cargo:z()?.cargo||"________________________",carnet_identidad:z()?.carnet_identidad||"________________________",fecha:"________________________"});const ee=i=>i?parseFloat(i).toLocaleString("es-ES",{minimumFractionDigits:2,maximumFractionDigits:2}).replace(/\./g," ").replace(",",","):"0,00",z=()=>s.factura.contrato?.trabajadorAutorizado?s.factura.contrato.trabajadorAutorizado:s.factura.trabajadorAutorizado?s.factura.trabajadorAutorizado:null,ge=()=>{try{const i=document.getElementById("factura-content"),t=document.body.innerHTML,_=document.title,V=window.open("","_blank");V.document.write(`
      <html>
        <head>
          <title>Factura ${s.factura.num_consecutivo}</title>
          <style>
            body { 
              font-family: Arial, sans-serif; 
              margin: 0; 
              padding: 20px; 
              font-size: 12px;
            }
            @media print {
              body { margin: 0; padding: 10px; }
              .no-print { display: none; }
            }
            table { border-collapse: collapse; width: 100%; }
            th, td { border: 1px solid #000; padding: 8px; text-align: left; }
            th { background-color: #f0f0f0; font-weight: bold; }
            .text-center { text-align: center; }
            .text-right { text-align: right; }
            .font-bold { font-weight: bold; }
            .border-b { border-bottom: 1px solid #000; }
          </style>
        </head>
        <body>
          ${i.innerHTML}
        </body>
      </html>
    `),V.document.close(),V.focus(),V.print(),V.close()}catch(i){console.error("Error imprimiendo:",i),alert("Error al imprimir. Intente nuevamente.")}},ue=async()=>{try{const[{default:i},{default:t}]=await Promise.all([Fe(()=>import("./CyMFbyVm.js").then(G=>G.j),__vite__mapDeps([0,1,2]),import.meta.url),Fe(()=>import("./B0tyYwQk.js"),[],import.meta.url)]),_=document.getElementById("factura-content"),V=_.querySelectorAll(".no-print"),oe=[];V.forEach(G=>{oe.push(G.style.display),G.style.display="none"});const L=await t(_,{scale:2,useCORS:!0,allowTaint:!0,backgroundColor:"#ffffff"});V.forEach((G,ne)=>{G.style.display=oe[ne]});const ce=L.toDataURL("image/png"),ae=new i("p","mm","a4"),W=210,_e=295,X=L.height*W/L.width;let re=X,a=0;for(ae.addImage(ce,"PNG",0,a,W,X),re-=_e;re>=0;)a=re-X,ae.addPage(),ae.addImage(ce,"PNG",0,a,W,X),re-=_e;const o=s.factura.num_consecutivo||"",n=s.factura.contrato?.entidad?.nombre||"",f=s.factura.contrato?.ClienteOProveedor||"",v=`Factura ${o} ${n} - ${f}.pdf`.replace(/[^a-zA-Z0-9\s\-_.]/g,"").trim();ae.save(v)}catch(i){console.error("Error generando PDF:",i),alert("Error al generar el PDF. Intente nuevamente.")}},I=U(()=>{const i=s.factura.servicio?s.factura.servicio.length:0,t=s.factura.productos?s.factura.productos.length:0,_=i+t,V=xo-_;return V>0?Array.from({length:V},(oe,L)=>L+1):[]});return(i,t)=>(w(),x(ve,null,[c.modelValue?(w(),x("div",Ct,[e("div",Ft,[e("div",Vt,[t[9]||(t[9]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Vista PDF de Factura",-1)),e("div",$t,[e("button",{onClick:ge,class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600",disabled:!q.value}," Imprimir ",8,Et),e("button",{onClick:ue,class:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600",disabled:!q.value}," Descargar PDF ",8,St),e("button",{onClick:t[0]||(t[0]=_=>i.$emit("update:modelValue",!1)),class:"text-gray-500 hover:text-gray-700"},[...t[8]||(t[8]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])])]),q.value?B("",!0):(w(),x("div",Pt,[t[10]||(t[10]=e("div",{class:"flex items-center"},[e("svg",{class:"w-5 h-5 mr-2",fill:"currentColor",viewBox:"0 0 20 20"},[e("path",{"fill-rule":"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z","clip-rule":"evenodd"})]),e("strong",null,"Error:"),k(" Faltan datos del vendedor. Complete la información requerida antes de imprimir o descargar el PDF. ")],-1)),e("ul",jt,[(w(!0),x(ve,null,fe(de.value,_=>(w(),x("li",{key:_},m(ye(_)),1))),128))])])),e("div",Tt,[e("div",It,[t[11]||(t[11]=e("h1",{class:"text-lx font-bold mb-2",style:{color:"#dc2626","font-size":"40px","letter-spacing":"1px"}},"FACTURA",-1)),t[12]||(t[12]=e("div",{class:"border-b border-blue-500 w-full mb-3",style:{"border-color":"#3b82f6"}},null,-1)),e("p",Dt,"Nombre del Trabajo: "+m(c.factura.contrato?.ClienteOProveedor==="Cliente"?"Servicio Prestado":"Compra Realizada"),1)]),e("div",Mt,[e("div",Nt,[e("p",zt,[e("strong",null,"Factura N: "+m(c.factura.num_consecutivo),1)]),t[13]||(t[13]=e("p",{class:"mb-1 text-lg"},[e("strong",null,"Fecha: ___________")],-1))])]),e("div",At,[e("div",null,[e("div",{class:"flex justify-between items-center mb-2"},[t[15]||(t[15]=e("h3",{class:"font-bold",style:{color:"#2563eb","font-size":"18px"}},"Vendedor",-1)),e("button",{onClick:Q,class:"text-blue-500 hover:text-blue-700 text-xs px-2 py-1 border border-blue-500 rounded no-print",title:"Configurar datos del vendedor"},[...t[14]||(t[14]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})],-1)])])]),e("div",Ut,[e("div",Bt,[e("p",null,[t[16]||(t[16]=e("strong",null,"Nombre:",-1)),k(" "+m(y("nombre")),1)])]),e("div",Ot,[e("p",null,[t[17]||(t[17]=e("strong",null,"Carné Identidad:",-1)),k(" "+m(y("carnet_identidad")),1)])]),e("div",Lt,[e("p",null,[t[18]||(t[18]=e("strong",null,"Identificación Fiscal (RC-05):",-1)),k(" "+m(y("identificacion_fiscal")),1)])]),e("div",Ht,[e("p",null,[t[19]||(t[19]=e("strong",null,"Cuenta Bancaria:",-1)),k(" "+m(y("cuenta_bancaria").replace(/-/g,"")),1)])]),e("div",Rt,[e("p",null,[t[20]||(t[20]=e("strong",null,"Agencia Bancaria:",-1)),k(" "+m(y("agencia_bancaria")),1)])]),e("div",Kt,[e("p",null,[t[21]||(t[21]=e("strong",null,"Dirección Particular:",-1)),k(" "+m(y("direccion_particular")),1)])]),e("div",qt,[e("p",null,[t[22]||(t[22]=e("strong",null,"Teléfono:",-1)),k(" "+m(y("telefono")),1)])])])]),e("div",null,[t[27]||(t[27]=e("h3",{class:"font-bold mb-2",style:{color:"#2563eb","font-size":"18px"}},"Comprador",-1)),e("div",Gt,[e("div",Jt,[e("p",null,[t[23]||(t[23]=e("strong",null,"Nombre:",-1)),k(" "+m(c.factura.contrato?.entidad?.nombre||"_________________"),1)])]),e("div",Wt,[e("p",null,[t[24]||(t[24]=e("strong",null,"Código:",-1)),k(" "+m(c.factura.contrato?.entidad?.consecutivo||"_________________"),1)])]),e("div",Yt,[e("p",null,[t[25]||(t[25]=e("strong",null,"Dirección:",-1)),k(" "+m(c.factura.contrato?.entidad?.direccion||"_________________"),1)])]),e("div",Zt,[e("p",null,[t[26]||(t[26]=e("strong",null,"Cuenta Bancaria:",-1)),k(" "+m((c.factura.contrato?.entidad?.cuenta_bancaria||"_________________").replace(/-/g,"")),1)])])])])]),t[44]||(t[44]=e("div",{class:"border-b border-black w-full mb-3"},null,-1)),e("table",Qt,[t[29]||(t[29]=e("thead",null,[e("tr",{style:{"background-color":"#f0f0f0"}},[e("th",{class:"border border-black p-2 text-center font-bold"},"Descripción"),e("th",{class:"border border-black p-2 text-center font-bold"},"U/M"),e("th",{class:"border border-black p-2 text-center font-bold"},"Cantidad"),e("th",{class:"border border-black p-2 text-center font-bold"},"Precio en CUP"),e("th",{class:"border border-black p-2 text-center font-bold"},"Precio Total")])],-1)),e("tbody",null,[(w(!0),x(ve,null,fe(c.factura.servicio,_=>(w(),x("tr",{key:_.id_servicio},[e("td",Xt,m(_.descripcion),1),e("td",eo,m(_.unidadMedida),1),e("td",to,m(parseFloat(_.cantidad).toFixed(2)),1),e("td",oo,m(parseFloat(_.importe).toFixed(2)),1),e("td",ao,m((_.cantidad*parseFloat(_.importe)).toFixed(2)),1)]))),128)),(w(!0),x(ve,null,fe(c.factura.productos,_=>(w(),x("tr",{key:_.id_producto},[e("td",ro,m(_.nombre),1),e("td",no,m(_.unidadMedida),1),e("td",io,m(parseFloat(_.factura_producto?.cantidad||0).toFixed(2)),1),e("td",lo,m(parseFloat(_.factura_producto?.precioVenta||0).toFixed(2)),1),e("td",so,m(((_.factura_producto?.cantidad||0)*parseFloat(_.factura_producto?.precioVenta||0)).toFixed(2)),1)]))),128)),(w(!0),x(ve,null,fe(I.value,_=>(w(),x("tr",{key:`empty-${_}`},[...t[28]||(t[28]=[e("td",{class:"border border-black p-2 h-6"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1),e("td",{class:"border border-black p-2"},null,-1)])]))),128))])]),e("div",uo,[e("p",co,[e("strong",null,"Cantidad Total a Cobrar: $ "+m(ee(c.factura.suma_general)),1)])]),e("div",_o,[e("div",null,[t[34]||(t[34]=e("div",{class:"border-b border-black w-full mb-2"},null,-1)),t[35]||(t[35]=e("p",{class:"font-bold mb-2 text-center"},"Emitido",-1)),e("div",mo,[e("p",null,[t[30]||(t[30]=e("strong",null,"Nombre:",-1)),k(" "+m(c.factura.usuario?.nombre||"_________________"),1)]),e("p",null,[t[31]||(t[31]=e("strong",null,"Cargo:",-1)),k(" "+m(c.factura.usuario?.cargo||"_________________"),1)]),e("p",null,[t[32]||(t[32]=e("strong",null,"C. Identidad:",-1)),k(" "+m(c.factura.usuario?.carnet_identidad||"_________________"),1)]),t[33]||(t[33]=e("p",null,[e("strong",null,"Fecha:"),k(" ___________")],-1))]),t[36]||(t[36]=e("div",{class:"mt-3"},[e("div",{class:"border-b border-black w-full mb-1"}),e("p",{class:"font-bold text-center"},"Cuño")],-1))]),e("div",null,[t[41]||(t[41]=e("div",{class:"border-b border-black w-full mb-2"},null,-1)),t[42]||(t[42]=e("p",{class:"font-bold mb-2 text-center"},"Recibido",-1)),e("div",po,[e("p",null,[t[37]||(t[37]=e("strong",null,"Nombre:",-1)),k(" "+m(z()?.nombre||"________________________"),1)]),e("p",null,[t[38]||(t[38]=e("strong",null,"Cargo:",-1)),k(" "+m(z()?.cargo||"________________________"),1)]),e("p",null,[t[39]||(t[39]=e("strong",null,"C. Identidad:",-1)),k(" "+m(z()?.carnet_identidad||"________________________"),1)]),t[40]||(t[40]=e("p",null,[e("strong",null,"Fecha:"),k(" ________________________")],-1))]),t[43]||(t[43]=e("div",{class:"mt-3"},[e("div",{class:"border-b border-black w-full mb-1"}),e("p",{class:"font-bold text-center"},"Cuño")],-1))])])])])])):B("",!0),u.value?(w(),x("div",vo,[e("div",bo,[e("div",{class:"flex justify-between items-center mb-6"},[t[46]||(t[46]=e("h2",{class:"text-2xl font-bold text-gray-800"},"Configurar Datos del Vendedor",-1)),e("button",{onClick:K,class:"text-gray-500 hover:text-gray-700"},[...t[45]||(t[45]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:$e(se,["prevent"]),class:"space-y-4"},[e("div",null,[t[47]||(t[47]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Nombre Completo",-1)),P(e("input",{"onUpdate:modelValue":t[1]||(t[1]=_=>p.value.nombre=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el nombre completo"},null,512),[[j,p.value.nombre]])]),e("div",null,[t[48]||(t[48]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Carné de Identidad",-1)),P(e("input",{"onUpdate:modelValue":t[2]||(t[2]=_=>p.value.carnet_identidad=_),onInput:N,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el carné de identidad"},null,544),[[j,p.value.carnet_identidad]]),S.value.carnet_identidad?(w(),x("p",go,m(S.value.carnet_identidad),1)):B("",!0)]),e("div",null,[t[49]||(t[49]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Identificación Fiscal (RC-05)",-1)),P(e("input",{"onUpdate:modelValue":t[3]||(t[3]=_=>p.value.identificacion_fiscal=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la identificación fiscal"},null,512),[[j,p.value.identificacion_fiscal]])]),e("div",null,[t[50]||(t[50]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Cuenta Bancaria",-1)),P(e("input",{"onUpdate:modelValue":t[4]||(t[4]=_=>p.value.cuenta_bancaria=_),onInput:h,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la cuenta bancaria"},null,544),[[j,p.value.cuenta_bancaria]]),S.value.cuenta_bancaria?(w(),x("p",fo,m(S.value.cuenta_bancaria),1)):B("",!0)]),e("div",null,[t[51]||(t[51]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Agencia Bancaria",-1)),P(e("input",{"onUpdate:modelValue":t[5]||(t[5]=_=>p.value.agencia_bancaria=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la agencia bancaria"},null,512),[[j,p.value.agencia_bancaria]])]),e("div",null,[t[52]||(t[52]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Dirección Particular",-1)),P(e("input",{"onUpdate:modelValue":t[6]||(t[6]=_=>p.value.direccion_particular=_),type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese la dirección particular"},null,512),[[j,p.value.direccion_particular]])]),e("div",null,[t[53]||(t[53]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Teléfono",-1)),P(e("input",{"onUpdate:modelValue":t[7]||(t[7]=_=>p.value.telefono=_),onInput:T,type:"text",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Ingrese el teléfono"},null,544),[[j,p.value.telefono]]),S.value.telefono?(w(),x("p",yo,m(S.value.telefono),1)):B("",!0)]),e("div",{class:"flex justify-end space-x-3 pt-4"},[e("button",{type:"button",onClick:K,class:"px-4 py-2 text-gray-600 border border-gray-300 rounded-lg hover:bg-gray-50"}," Cancelar "),t[54]||(t[54]=e("button",{type:"submit",class:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"}," Guardar Datos ",-1))])],32)])])):B("",!0)],64))}},ho=je(wo,[["__scopeId","data-v-027e2079"]]),ko={class:"min-h-screen bg-gradient-to-br via-secondary/40 from-accent/30 to-neutral"},Co={key:0,class:"fixed top-6 left-1/2 transform -translate-x-1/2 z-[9999] w-full max-w-md px-4 pointer-events-none"},Fo={key:1,class:"fixed top-24 left-1/2 transform -translate-x-1/2 z-[10000] w-full max-w-md px-4 pointer-events-auto"},Vo={class:"w-[95%] mx-auto px-4 py-4 md:py-4 mt-20 md:mt-0"},$o={class:"bg-white rounded-lg shadow-md p-4"},Eo={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},So={class:"w-full"},Po={class:"w-full"},jo={class:"w-full"},To={class:"w-full"},Io={class:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4"},Do={class:"w-full"},Mo={class:"w-full"},No={class:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-4"},zo={class:"w-full"},Ao={class:"w-full"},Uo={class:"w-full"},Bo={class:"w-full"},Oo={class:"w-[95%] mx-auto px-4 py-4"},Lo={class:"mt-6 bg-white rounded-lg shadow-md p-4 w-[95%] mx-auto"},Ho={class:"grid grid-cols-2 md:grid-cols-4 gap-4 text-center"},Ro={class:"bg-orange-100 text-orange-800 rounded p-3"},Ko={class:"text-lg font-bold"},qo={class:"text-lg font-bold"},Go={class:"text-lg font-bold"},Jo={class:"bg-blue-100 text-blue-800 rounded p-3"},Wo={class:"text-lg font-bold"},Yo={class:"text-lg font-bold"},Zo={class:"text-lg font-bold"},Qo={class:"bg-orange-100 text-orange-800 rounded p-3"},Xo={class:"text-lg font-bold"},ea={class:"text-lg font-bold"},ta={class:"text-lg font-bold"},oa={class:"bg-blue-100 text-blue-800 rounded p-3"},aa={class:"text-lg font-bold"},ra={class:"text-lg font-bold"},na={class:"text-lg font-bold"},pa={__name:"facturas",setup(c){const Y=g(""),s=g(""),Z=g(""),u=g(""),p=g(""),S=g(""),H=g(""),$=g(""),C=g(""),N=g(""),h=g([{label:"Todos",value:null},{label:"Facturado",value:"Facturado"},{label:"No Facturado",value:"No Facturado"},{label:"Cancelado",value:"Cancelado"}]),T=g([]),O=g(null),se=g(null),y=g(!1),Q=g(!1),K=g({}),q=g(!1),de=g(!1),ye=[{key:"num_consecutivo",label:"Num. Consecutivo"},{key:"fecha",label:"Fecha",cellRenderer:l=>l?`<span class="px-2 py-1 rounded text-sm">${l.substring(0,10)}</span>`:""},{key:"estado",label:"Estado",cellRenderer:l=>{if(!l)return"";let r="";return l==="Facturado"?r="bg-green-100 text-green-800":l==="No Facturado"?r="bg-yellow-100 text-yellow-800":l==="Cancelado"&&(r="bg-red-100 text-red-800"),`<span class="px-2 py-1 rounded-full text-sm font-medium ${r}">${l}</span>`}},{key:"contrato.ClienteOProveedor",label:"Cliente o Proveedor",cellRenderer:l=>l?`<span class="px-2 py-1 rounded-full text-sm font-medium ${l==="Cliente"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}">${l}</span>`:""},{key:"contrato.num_consecutivo",label:"Contrato"},{key:"contrato.tipoContrato.nombre",label:"Tipo Contrato"},{key:"suma_general",label:"Importe",cellRenderer:l=>{if(l==null||l==="")return"";const r=parseFloat(l);return isNaN(r)?l:`<span class="px-2 py-1 rounded text-sm">${r.toFixed(2)}</span>`}},{key:"contrato.entidad.nombre",label:"Entidad"},{key:"usuario.nombre",label:"Creado por"}],J=g(1),ee=g(0),z=g(!1),ge=g(10),ue=g([]),I=g({}),i=g(null),t=g(!1),_=g(null),V=he(),oe=[{name:"Editar",icon:{render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5M18.5 2.5a2.121 2.121 0 113 3L12 15l-4 1 1-4 7.5-7.5z"})])}},handler:l=>X(l,"editar"),iconOnly:!1,buttonClass:"px-3 py-1 bg-accent text-neutral rounded-md hover:bg-accent/90"},{name:"Ver en PDF",icon:{render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"}),me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 9h6m-6 4h6m-6 4h6"})])}},handler:l=>a(l),iconOnly:!1,buttonClass:"px-3 py-1 bg-blue-500 text-white rounded-md hover:bg-blue-600"}],L=async()=>{try{z.value=!0,await W(1)}catch(l){console.error("Error al buscar facturas:",l)}finally{z.value=!1}};function ce(l){W(l)}function ae(l){X(l,"ver")}async function W(l=1){const r=localStorage.getItem("token");if(!r){D("/");return}try{const d={id_contrato:H.value||0,id_entidad:$.value||0,consecutivoEntidad:Y.value||void 0,organismoEntidad:s.value||void 0,num_consecutivo:Z.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:S.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},F=await fetch(`${V.public.backendHost}/Factura/filterFacturas/${l}/${ge.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:r},body:JSON.stringify(d)});if(F.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(F.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}const E=await F.json();ue.value=E.data||[],ee.value=E.pagination?.total||0,J.value=E.pagination?.currentPage||1,I.value=E.pagination}catch{i.value={title:"Error",description:"No se pudieron cargar las facturas",type:"error"}}}async function _e(l){if(!l){T.value=[];return}const r=localStorage.getItem("token");if(!r){D("/");return}try{const d=await fetch(`${V.public.backendHost}/entidad/${l}`,{method:"GET",headers:{Authorization:r}});if(d.status===401||d.status===403){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(d.ok){const F=await d.json();O.value=F;const E=F?.contratos||[];T.value=E.map(A=>({...A,displayLabel:`${A.num_consecutivo} - ${A.tipoContrato?.nombre||""} - ${A.ClienteOProveedor||""}`}))}else console.error("Error en la respuesta:",d.status),T.value=[]}catch(d){console.error("Error al cargar contratos:",d),T.value=[]}}function X(l,r){K.value=l?{...l}:{},q.value=r==="editar",de.value=r==="ver",y.value=!0}function re(){X({},"crear")}function a(l){K.value={...l},Q.value=!0}async function o(){if(!_.value)return;const l=localStorage.getItem("token");if(!l){D("/");return}try{const r=await fetch(`${V.public.backendHost}/Factura/deleteFactura/${_.value.id_factura}`,{method:"DELETE",headers:{Authorization:l}});if(r.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(r.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!r.ok){let d="No se pudo eliminar la factura";try{const F=await r.json();F&&F.message&&(d=F.message)}catch{}throw new Error(d)}i.value={title:"Éxito",description:"Factura eliminada correctamente",type:"success"},W(J.value)}catch(r){i.value={title:"Error",description:r.message,type:"error"}}finally{t.value=!1,_.value=null}}const n=async l=>{const r=localStorage.getItem("token");if(!r){D("/");return}try{const d=q.value?`${V.public.backendHost}/Factura/updateFactura/${K.value.id_factura}`:`${V.public.backendHost}/Factura/createFactura`,F=await fetch(d,{method:q.value?"PUT":"POST",headers:{"Content-Type":"application/json",Authorization:r,Accept:"application/json"},body:JSON.stringify(l)});if(F.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(F.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción.",type:"error"};return}if(F.status===400||F.status===500){const E=await F.json();E.errors&&Array.isArray(E.errors)?i.value={title:`Errores de validación: ${F.status}`,description:E.errors.join(`
`),type:"error"}:E.error?i.value={title:`Error: ${F.status}`,description:E.error,type:"error"}:i.value={title:`Error: ${F.status}`,description:JSON.stringify(E),type:"error"};return}if(!F.ok){let E="No se pudo guardar la factura";try{const A=await F.json();A&&A.message&&(E=A.message)}catch{}throw new Error(E)}i.value={title:"Éxito",description:q.value?"Factura actualizada correctamente":"Factura creada correctamente",type:"success"},y.value=!1,W(J.value)}catch(d){i.value={title:"Error",description:d.message,type:"error"}}};async function f(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),r={id_contrato:H.value||0,id_entidad:$.value||0,consecutivoEntidad:Y.value||void 0,organismoEntidad:s.value||void 0,num_consecutivo:Z.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:S.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},d=await fetch(`${V.public.backendHost}/Factura/filterFacturas/1/${ee.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(r)});if(d.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(d.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!d.ok){const b=await d.json();i.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const E=(await d.json()).data.map(b=>({"Num. Consecutivo":b.num_consecutivo,Fecha:b.fecha?b.fecha.substring(0,10):"",Estado:b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Importe:b.suma_general?parseFloat(b.suma_general).toFixed(2):"",Entidad:b.contrato?.entidad?.nombre||""})),A=te.json_to_sheet(E),ie=te.book_new();te.book_append_sheet(ie,A,"Facturas");const xe=new Date().toISOString().split("T")[0];Ce(ie,`facturas_${xe}.xlsx`),i.value=null}catch(l){console.error("Error al exportar a Excel:",l),i.value={title:"Error",description:"Ocurrió un error al exportar los datos.",type:"error"}}}async function v(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),r={id_contrato:H.value||0,id_entidad:$.value||0,consecutivoEntidad:Y.value||void 0,organismoEntidad:s.value||void 0,num_consecutivo:Z.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:S.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},d=await fetch(`${V.public.backendHost}/Factura/filterFacturas/1/${ee.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(r)});if(d.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(d.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!d.ok){const b=await d.json();i.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const F=await d.json(),E=[];F.data.forEach(b=>{b.productos&&b.productos.length>0&&b.productos.forEach(R=>{E.push({"Num. Consecutivo Factura":b.num_consecutivo,"Fecha Factura":b.fecha?b.fecha.substring(0,10):"","Estado Factura":b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Entidad:b.contrato?.entidad?.nombre||"","Código Producto":R.codigo,"Nombre Producto":R.nombre,"Unidad de Medida":R.unidadMedida,"Nota Producto":R.nota,"Tipo Producto":R.tipoProducto,"Cantidad Existencia":R.cantidadExistencia,"Cantidad Facturada":R.factura_producto?.cantidad||"","Precio Venta":Number(R.factura_producto?.precioVenta).toFixed(2)||""})})});const A=te.json_to_sheet(E),ie=te.book_new();te.book_append_sheet(ie,A,"Facturas con Productos");const xe=new Date().toISOString().split("T")[0];Ce(ie,`facturas_con_productos_${xe}.xlsx`),i.value=null}catch(l){console.error("Error al exportar a Excel con productos:",l),i.value={title:"Error",description:"Ocurrió un error al exportar los datos con productos.",type:"error"}}}async function G(){i.value={title:"Consultando datos",description:"Se están consultando los datos, la descarga comenzará en breve.",type:"info"};try{const l=localStorage.getItem("token"),r={id_contrato:H.value||0,id_entidad:$.value||0,consecutivoEntidad:Y.value||void 0,organismoEntidad:s.value||void 0,num_consecutivo:Z.value||0,fecha_desde:u.value||void 0,fecha_hasta:p.value||void 0,estado:S.value||void 0,id_trabajador_autorizado:C.value||0,id_usuario:N.value||0},d=await fetch(`${V.public.backendHost}/Factura/filterFacturas/1/${ee.value}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:l,Accept:"application/json"},body:JSON.stringify(r)});if(d.status===401){i.value={title:"Sesión Expirada",description:"Tu sesión ha expirado. Por favor, inicia sesión nuevamente.",type:"warning"},localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout(()=>{D("/")},3e3);return}if(d.status===403){i.value={title:"Acceso Denegado",description:"No tienes permisos para realizar esta acción o acceder a esta información.",type:"error"};return}if(!d.ok){const b=await d.json();i.value={title:"Error al consultar datos",description:b.error||"Ocurrió un error al consultar los datos.",type:"error"};return}const F=await d.json(),E=[];F.data.forEach(b=>{b.servicio&&b.servicio.length>0&&b.servicio.forEach(R=>{E.push({"Num. Consecutivo Factura":b.num_consecutivo,"Fecha Factura":b.fecha?b.fecha.substring(0,10):"","Estado Factura":b.estado,"Creado por":b.usuario?.nombre||"","Cliente o Proveedor":b.contrato?.ClienteOProveedor||"",Contrato:b.contrato?.num_consecutivo||"","Tipo Contrato":b.contrato?.tipoContrato?.nombre||"",Entidad:b.contrato?.entidad?.nombre||"","Descripción Servicio":R.descripcion,"Importe Servicio":R.importe,"Cantidad Servicio":R.cantidad,"Unidad de Medida":R.unidadMedida})})});const A=te.json_to_sheet(E),ie=te.book_new();te.book_append_sheet(ie,A,"Facturas con Servicios");const xe=new Date().toISOString().split("T")[0];Ce(ie,`facturas_con_servicios_${xe}.xlsx`),i.value=null}catch(l){console.error("Error al exportar a Excel con servicios:",l),i.value={title:"Error",description:"Ocurrió un error al exportar los datos con servicios.",type:"error"}}}function ne(l){l.value=l,l&&l.contratos?T.value=l.contratos.map(r=>({...r,displayLabel:`${r.num_consecutivo} - ${r.tipoContrato?.nombre||""} - ${r.ClienteOProveedor||""}`})):T.value=[],H.value=""}pe($,(l,r)=>{l&&!se.value?_e(l):l||(T.value=[],H.value="",se.value=null)},{immediate:!0}),Ee(()=>{if(!localStorage.getItem("token")){D("/");return}W()});const Pe={render(){return me("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-6 w-6 text-neutral",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[me("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})])}};return(l,r)=>(w(),x("div",ko,[M(Ie,{title:"Facturas - Pactum",description:"Lista y gestión de facturas en Pactum. Filtra, exporta y administra facturas.",canonical:"/facturas"}),M(Te),i.value?(w(),x("div",Co,[M(Se,{title:i.value.title,description:i.value.description,type:i.value.type,onClose:r[0]||(r[0]=d=>i.value=null),class:"pointer-events-auto"},null,8,["title","description","type"])])):B("",!0),t.value?(w(),x("div",Fo,[M(Me,{title:"¿Estás seguro que deseas eliminar esta factura?",description:"Esta acción no se puede deshacer.",icon:Pe,type:"warning",onConfirm:o,onClose:r[1]||(r[1]=d=>t.value=!1)})])):B("",!0),e("div",Vo,[e("div",$o,[e("div",Eo,[e("div",So,[r[14]||(r[14]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Consecutivo Entidad",-1)),P(e("input",{type:"text","onUpdate:modelValue":r[2]||(r[2]=d=>Y.value=d),placeholder:"Ingrese consecutivo entidad...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(L,["enter"])},null,544),[[j,Y.value]])]),e("div",Po,[r[15]||(r[15]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Organismo Entidad",-1)),P(e("input",{type:"text","onUpdate:modelValue":r[3]||(r[3]=d=>s.value=d),placeholder:"Ingrese organismo entidad...",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(L,["enter"])},null,544),[[j,s.value]])]),e("div",jo,[r[16]||(r[16]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Num. Consecutivo",-1)),P(e("input",{type:"number","onUpdate:modelValue":r[4]||(r[4]=d=>Z.value=d),placeholder:"Número consecutivo",class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(L,["enter"])},null,544),[[j,Z.value,void 0,{number:!0}]])]),e("div",To,[r[17]||(r[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Estado",-1)),M(ke,{modelValue:S.value,"onUpdate:modelValue":r[5]||(r[5]=d=>S.value=d),options:h.value,labelKey:"label",valueKey:"value",placeholder:"Seleccionar estado..."},null,8,["modelValue","options"])])]),e("div",Io,[e("div",Do,[r[18]||(r[18]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Desde",-1)),P(e("input",{type:"date","onUpdate:modelValue":r[6]||(r[6]=d=>u.value=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(L,["enter"])},null,544),[[j,u.value]])]),e("div",Mo,[r[19]||(r[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Fecha Hasta",-1)),P(e("input",{type:"date","onUpdate:modelValue":r[7]||(r[7]=d=>p.value=d),class:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-primary",onKeyup:we(L,["enter"])},null,544),[[j,p.value]])])]),e("div",No,[e("div",zo,[r[20]||(r[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Entidad por Nombre",-1)),M(be,{modelValue:$.value,"onUpdate:modelValue":r[8]||(r[8]=d=>$.value=d),endpoint:"/entidad/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_entidad",placeholder:"Buscar entidad por nombre...",onEntidadSeleccionada:ne},null,8,["modelValue"])]),e("div",Ao,[r[21]||(r[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Contrato por número consecutivo",-1)),M(ke,{modelValue:H.value,"onUpdate:modelValue":r[9]||(r[9]=d=>H.value=d),options:T.value,labelKey:"displayLabel",valueKey:"id_contrato",disabled:!$.value,class:le({"opacity-50":!$.value}),placeholder:"Seleccione primero una entidad..."},null,8,["modelValue","options","disabled","class"])]),e("div",Uo,[r[22]||(r[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Trabajador Autorizado por Nombre",-1)),M(be,{modelValue:C.value,"onUpdate:modelValue":r[10]||(r[10]=d=>C.value=d),endpoint:"/trabajadorAutorizado/filter/1/10",method:"POST","search-key":"nombre","label-key":"nombre","value-key":"id_trabajador",placeholder:"Buscar trabajador por nombre..."},null,8,["modelValue"])]),e("div",Bo,[r[23]||(r[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Usuario por Nombre",-1)),M(be,{modelValue:N.value,"onUpdate:modelValue":r[11]||(r[11]=d=>N.value=d),endpoint:"/Usuario/filterUsers",method:"POST","search-key":"nombre_usuario","label-key":"nombre_usuario","value-key":"id_usuario",placeholder:"Buscar usuario por nombre...","direct-data":!0},null,8,["modelValue"])])]),e("div",{class:"flex justify-end mt-4 gap-2 flex-wrap"},[e("button",{onClick:L,class:"px-6 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors"}," Buscar "),e("button",{onClick:f,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...r[24]||(r[24]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 5a2 2 0 012-2h4a2 2 0 012 2v2H8V5z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 12h2v2H7v-2zM11 12h2v2h-2v-2zM15 12h2v2h-2v-2z"})],-1),k(" Exportar a Excel ",-1)])]),e("button",{onClick:v,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...r[25]||(r[25]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),k(" Exportar a Excel con Productos ",-1)])]),e("button",{onClick:G,class:"px-6 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors flex items-center"},[...r[26]||(r[26]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})],-1),k(" Exportar a Excel con Servicios ",-1)])])])])]),e("div",Oo,[e("div",{class:"flex justify-between items-center mb-4"},[r[28]||(r[28]=e("h2",{class:"text-2xl font-bold"},"Facturas",-1)),e("button",{onClick:re,class:"px-4 py-2 bg-primary text-neutral rounded-lg hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary flex items-center"},[...r[27]||(r[27]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",class:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),k(" Nueva Factura ",-1)])])]),M(De,{columns:ye,items:ue.value,actions:oe,"total-items":ee.value,"items-per-page":ge.value,"current-page":J.value,"is-loading":z.value,onPageChange:ce,onRowClick:ae},null,8,["items","total-items","items-per-page","current-page","is-loading"]),e("div",Lo,[r[33]||(r[33]=e("h3",{class:"text-xl font-semibold mb-4"},"Resumen de Información Filtrada",-1)),e("div",Ho,[e("div",Ro,[r[29]||(r[29]=e("div",{class:"text-sm font-medium"},"Suma: Servicios que los Proveedores han prestado",-1)),e("div",Ko,"Facturado: "+m((I.value.serviciosProveedoresFacturados??0).toFixed(2)),1),e("div",qo,"No Facturado: "+m(((I.value.serviciosProveedores??0).toFixed(2)-(I.value.serviciosProveedoresFacturados??0).toFixed(2)).toFixed(2)),1),e("div",Go,"Total: "+m((I.value.serviciosProveedores??0).toFixed(2)),1)]),e("div",Jo,[r[30]||(r[30]=e("div",{class:"text-sm font-medium"},"Suma: Servicios prestados a Clientes",-1)),e("div",Wo,"Facturado: "+m((I.value.serviciosClientesFacturados??0).toFixed(2)),1),e("div",Yo,"No Facturado: "+m(((I.value.serviciosClientes??0).toFixed(2)-(I.value.serviciosClientesFacturados??0).toFixed(2)).toFixed(2)),1),e("div",Zo,"Total: "+m((I.value.serviciosClientes??0).toFixed(2)),1)]),e("div",Qo,[r[31]||(r[31]=e("div",{class:"text-sm font-medium"},"Suma: Productos comprados a Proveedores",-1)),e("div",Xo,"Facturado: "+m((I.value.productosProveedorFacturados??0).toFixed(2)),1),e("div",ea,"No Facturado: "+m(((I.value.productosProveedor??0).toFixed(2)-(I.value.productosProveedorFacturados??0).toFixed(2)).toFixed(2)),1),e("div",ta,"Total: "+m((I.value.productosProveedor??0).toFixed(2)),1)]),e("div",oa,[r[32]||(r[32]=e("div",{class:"text-sm font-medium"},"Suma: Productos vendidos a Clientes",-1)),e("div",aa,"Facturado: "+m((I.value.productosClientesFacturados??0).toFixed(2)),1),e("div",ra,"No Facturado: "+m(((I.value.productosClientes??0).toFixed(2)-(I.value.productosClientesFacturados??0).toFixed(2)).toFixed(2)),1),e("div",na,"Total: "+m((I.value.productosClientes??0).toFixed(2)),1)])])])]),M(kt,{modelValue:y.value,"onUpdate:modelValue":r[12]||(r[12]=d=>y.value=d),factura:K.value,"is-editing":q.value,"is-viewing":de.value,contratos:T.value,entidades:[],trabajadores:[],usuarios:[],onSubmit:n},null,8,["modelValue","factura","is-editing","is-viewing","contratos"]),M(ho,{modelValue:Q.value,"onUpdate:modelValue":r[13]||(r[13]=d=>Q.value=d),factura:K.value},null,8,["modelValue","factura"])]))}};export{pa as default};
